<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데이터베이스의 고가용성 패턴</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- 사이드바 -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>˗ˏˋ ⋆｡𖦹 ˚ 𓇼 ˚｡⋆ ❀˖°</p>
        <p>옛날에 
 데이터 엔지니어가 있엇슨.. 백엔드 서버도 만들고 인프라도 구축하고 데이터 분석도 했슨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    ⠀⠀⠀⠀⠀⠀⢀⡤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢀⡏⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⣀⠴⠋⠉⠉⡆⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠈⠉⠉⠙⠓⠚⠁⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⢀⠞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⠀⠀
    ⠀⠀⠀⠀⡞⠀⠀⠀⠀⠀⠶⠀⠀⠀⠀⠀⠀⠦⠀⠀⠀⠀⠀⠸⡆⠀⠀⠀
    ⢠⣤⣶⣾⣧⣤⣤⣀⡀⠀⠀⠀⠀⠈⠀⠀⠀⢀⡤⠴⠶⠤⢤⡀⣧⣀⣀⠀
    ⠻⠶⣾⠁⠀⠀⠀⠀⠙⣆⠀⠀⠀⠀⠀⠀⣰⠋⠀⠀⠀⠀⠀⢹⣿⣭⣽⠇
    ⠀⠀⠙⠤⠴⢤⡤⠤⠤⠋⠉⠉⠉⠉⠉⠉⠉⠳⠖⠦⠤⠶⠦⠞⠁⠀⠀⠀
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 헤더 -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- 콘텐츠 영역 -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">데이터베이스의 고가용성 패턴</h1>
        <div class="post-meta">
            <time class="post-date">2024년 10월 11일</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">Development</span>
                    
                
                    
                
                
                <span class="subcategory-tag">Database</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#database</span>
                
                <span class="tag">#high-availability</span>
                
                <span class="tag">#infrastructure</span>
                
                <span class="tag">#rdbms</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="데이터베이스-고가용성-패턴">데이터베이스 고가용성 패턴</h1>

<p><img src="/assets/images/post_img/db-ha패턴.png" alt="" /></p>

<h2 id="1-레플리케이션">1. 레플리케이션</h2>

<h3 id="1-마스터-슬레이브-구조-primary-slave-구조">1) 마스터-슬레이브 구조 (primary-slave 구조)</h3>

<p>하나의 마스터가 쓰기 작업을 처리하고 여러 슬레이브가 읽기 작업을 처리. 마스터가 다운되면 슬레이브를 마스터로 승격해서 운영할 수 있지만 이건 failover 방식이고 따로 구성한다.</p>

<h3 id="2-리더-팔로워-구조">2) 리더-팔로워 구조</h3>

<p>리더가 쓰기 요청을 처리하고 팔로워는 리더로부터 데이터를 복제하여 읽기 요청을 처리. 읽기 부하를 분산시키고, 리더 장애시 팔로워중 하나를 리더로 승격</p>

<h2 id="2-auto-failover">2. auto failover</h2>

<p>장애가 발생햇을때 자동으로 다른 노드로 트래픽을 전환하는 fail over 매커니즘을 구축. 로드 밸런서를 설정하고 db 장애시 빠르게 다른 인스턴스로 전환</p>

<h2 id="3-load-balancing">3. load balancing</h2>

<p>읽기 전용 트래픽을 여러 db 인스턴스에 분산해 부하를 줄이고, 장애시 트래픽을 다른 인스턴스로 전환할 수 있다. 읽기 작업이 많은 경우 다중 읽기 replica 를 사용해 성능과 안정성을 높인다.</p>

<h2 id="4-백업-및-복구-전략">4. 백업 및 복구 전략</h2>

<p>주기적으로 db를 백업하고 장애시 백업 데이터를 기반으로 빠르게 복구할 수 있는 전략을 마련
postgresql 에서는 wal을 사용해 트랜잭션 로그를 기록하고 복구 시 로그를 사용해 최신 상태로 복구할 수 있다.</p>

<h2 id="5-컨테이너화-및-오케스트레이션">5. 컨테이너화 및 오케스트레이션</h2>

<p>db 및 기타 서비스를 컨테이너화하고 오케스트레이션 툴을 이용하면 고가용성을 쉽게 구축할 수 있음</p>

<h1 id="failover">failover</h1>

<p><img src="/assets/images/post_img/db-ha-failover.png" alt="" /></p>

<p>마스터 장애시 자동으로 슬레이브를 새로운 마스터로 승격하는 방법</p>

<h2 id="1-auto-failover">1. auto failover</h2>

<h3 id="1-pg_auto_failover">1) pg_auto_failover</h3>

<p>postgresql의 자동 failover를 지원하는 도구로 마스터 장애 발생시 현재의 슬레이브 노드 중에서 가장 최신의 데이터를 가진 노드를 새로운 마스터로 승격</p>

<h3 id="2-repmgr">2) repmgr</h3>

<p>postgresql에서 마스터-슬레이브 구조의 복제를 관리하는 도구. 자동 fail over를 지원. 마스터가 장애를 겪으면 repmgr이 슬레이브 중 하나를 새로운 마스터로 승격. 다른 슬레이브들은 새로운 마스터와 동기화.</p>

<h3 id="3-pgpool-2">3) pgpool-2</h3>

<p>postgresql의 로드밸런싱과 자동 페일오버 기능을 지원하는 미들웨어. 주기적으로 마스터와 슬레이브의 상태를 모니터링하고 장애가 발생하면 페일오버를 해준다. 클러스터 내의 데이터 베이스 인스턴스들을 관리하며 자동으로 장애조치를 수행한다.</p>

<h2 id="2-수동-failover">2. 수동 failover</h2>

<h3 id="1-trigger-file-방식">1) trigger file 방식</h3>

<p>슬레이브 인스턴스가 대기 상태로 있대가 트리거 파일이 생성되면 해당 노드가 즉시 마스터로 승격됨. 직접 파일을 만들어 관리자가 수동으로 failover를 실행할 수 잇게 해줌.</p>

<h3 id="2-pg_ctl-remote">2) pg_ctl remote</h3>

<p>postgresql 에서 슬레이브를 수동으로 마스터로 승격하기 위해 pg_ctl remote 명령을 사용. 이 명령을 통해 슬레이브가 복제 모드를 종료하고 마스터 역할을 수행하도록 함. 수동으로 마스터를 지정할 수 있음</p>

<h3 id="3-정상종료-후-재구성">3) 정상종료 후 재구성</h3>

<p>마스터에 장애가 발생하면 수동으로 마스터를 종료하고 슬레이브를 마스터로 승격한 이후 다른 슬레이브 인스턴스를 재구성하여 동기화하는 방법이 있음</p>

<h2 id="3-heart-beat-기반-솔루션">3. Heart beat 기반 솔루션</h2>

<p><a href="https://duri-wip.github.io/database/hearbeat-solution/">HA 패턴 중 하트비트 기반 솔루션, pacemaker</a></p>

<hr />

<h2 id="고가용성-패턴-적용시-고려사항">고가용성 패턴 적용시 고려사항</h2>

<ol>
  <li>장애 발생시 얼마나 빠르게 복구할 수 있는지 -&gt; 자동화된 failover, 자동화된 백업 복구 전략</li>
  <li>db 상태를 모니터링하고, 이상이 발생하면 경고를 받을 수 있는지 -&gt; 실시간 모니터링 및 알림 시스템 구축(프로메테우스와 그라파나 등을 활용)</li>
  <li>데이터 일관성 유지 -&gt; strong consistency, eventual consistency 중 하나를 선택해야함</li>
</ol>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/development/DB-db-and-storage/">
                <span class="nav-label">이전 글</span>
                <span class="nav-title">데이터베이스와 스토리지</span>
            </a>
            
            
            
            <a class="next-post" href="/development/DB-heartbeat-failover/">
                <span class="nav-label">다음 글</span>
                <span class="nav-title">HA 패턴 중 하트비트 기반 솔루션, pacemaker</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">← 홈으로 돌아가기</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>