<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark 애플리케이션</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- 사이드바 -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>˗ˏˋ ⋆｡𖦹 ˚ 𓇼 ˚｡⋆ ❀˖°</p>
        <p>옛날에 
 데이터 엔지니어가 있엇슨.. 백엔드 서버도 만들고 인프라도 구축하고 데이터 분석도 했슨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    ⠀⠀⠀⠀⠀⠀⢀⡤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢀⡏⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⣀⠴⠋⠉⠉⡆⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠈⠉⠉⠙⠓⠚⠁⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⢀⠞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⠀⠀
    ⠀⠀⠀⠀⡞⠀⠀⠀⠀⠀⠶⠀⠀⠀⠀⠀⠀⠦⠀⠀⠀⠀⠀⠸⡆⠀⠀⠀
    ⢠⣤⣶⣾⣧⣤⣤⣀⡀⠀⠀⠀⠀⠈⠀⠀⠀⢀⡤⠴⠶⠤⢤⡀⣧⣀⣀⠀
    ⠻⠶⣾⠁⠀⠀⠀⠀⠙⣆⠀⠀⠀⠀⠀⠀⣰⠋⠀⠀⠀⠀⠀⢹⣿⣭⣽⠇
    ⠀⠀⠙⠤⠴⢤⡤⠤⠤⠋⠉⠉⠉⠉⠉⠉⠉⠳⠖⠦⠤⠶⠦⠞⠁⠀⠀⠀
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 헤더 -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- 콘텐츠 영역 -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">Spark 애플리케이션</h1>
        <div class="post-meta">
            <time class="post-date">2024년 10월 21일</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">DataEngineering</span>
                    
                
                    
                
                
                <span class="subcategory-tag">spark</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#spark</span>
                
                <span class="tag">#apache-spark</span>
                
                <span class="tag">#big-data</span>
                
                <span class="tag">#distributed-computing</span>
                
                <span class="tag">#scala</span>
                
                <span class="tag">#python</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="spark-애플리케이션"><strong>Spark 애플리케이션</strong></h1>

<h2 id="스파크-애플리케이션이란"><strong>스파크 애플리케이션이란?</strong></h2>

<p>스파크 애플리케이션은 드라이버와 익스큐터 프로세스로 실행되는 프로그램이다. 클러스터 매니저가 애플리케이션에 필요한 자원을 할당하여 효율적으로 실행된다.</p>

<h2 id="스파크의-기본-아키텍처"><strong>스파크의 기본 아키텍처</strong></h2>

<p>스파크는 클러스터에서 작업을 조율하는 프레임워크이다. 클러스터 매니저가 애플리케이션에 자원을 할당하며, 이를 통해 작업을 병렬로 처리한다.</p>

<h2 id="스파크-애플리케이션-구조"><strong>스파크 애플리케이션 구조</strong></h2>

<p><img src="/assets/images/post_img/spark-application-structure.png" alt="" /></p>

<p>스파크 애플리케이션은 <strong>드라이버</strong>와 <strong>익스큐터</strong>로 구성된 마스터-슬레이브 구조이다.</p>

<ul>
  <li><strong>드라이버</strong>는 스파크 컨텍스트를 생성하고, 클러스터 매니저와 통신해 자원을 관리하며 애플리케이션의 전체 수명주기를 관리한다.</li>
  <li><strong>익스큐터</strong>는 드라이버로부터 작업을 받아 수행하고, 작업 결과를 드라이버에게 보고한다.</li>
</ul>

<h3 id="파티션"><strong>파티션</strong></h3>

<p>스파크는 데이터를 파티션 단위로 나눠 병렬로 작업을 수행한다. 기본적으로 파티션은 1개로 설정되며, 필요에 따라 조정할 수 있다.</p>

<h3 id="드라이버-실행-모드"><strong>드라이버 실행 모드</strong></h3>

<ul>
  <li><strong>클라이언트 모드</strong>: 클러스터 외부에서 드라이버를 실행한다.</li>
  <li><strong>클러스터 모드</strong>: 클러스터 내에서 드라이버를 실행한다.</li>
</ul>

<h2 id="스파크-잡의-구성"><strong>스파크 잡의 구성</strong></h2>

<ul>
  <li><strong>잡(Job)</strong>: 애플리케이션에서 제출된 작업 단위이다.</li>
  <li><strong>스테이지(Stage)</strong>: 잡을 여러 작업 단위로 나눈 것이다.</li>
  <li><strong>태스크(Task)</strong>: 각 스테이지 내에서 익스큐터가 처리하는 개별 작업이다. 각 파티션에 대해 병렬로 실행된다.</li>
</ul>

<h2 id="스파크-애플리케이션-실행하기"><strong>스파크 애플리케이션 실행하기</strong></h2>

<h3 id="실행-방식"><strong>실행 방식</strong></h3>

<p>스파크는 다양한 언어로 애플리케이션을 실행할 수 있는 스크립트를 제공한다. 각 스크립트는 스파크의 <code class="language-plaintext highlighter-rouge">bin</code> 디렉토리에 있다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /usr/local/spark/bin

<span class="c"># bin 디렉토리 실행 파일 목록</span>
<span class="nt">-rwxr-xr-x</span> 1 root root 1099 Nov 16  2016 beeline
<span class="nt">-rw-r--r--</span> 1 root root 2143 Nov 16  2016 load-spark-env.sh
<span class="nt">-rwxr-xr-x</span> 1 root root 3265 Nov 16  2016 pyspark
<span class="nt">-rwxr-xr-x</span> 1 root root 1040 Nov 16  2016 run-example
<span class="nt">-rwxr-xr-x</span> 1 root root 3126 Nov 16  2016 spark-class
<span class="nt">-rwxr-xr-x</span> 1 root root 1049 Nov 16  2016 sparkR
<span class="nt">-rwxr-xr-x</span> 1 root root 3026 Nov 16  2016 spark-shell
<span class="nt">-rwxr-xr-x</span> 1 root root 1075 Nov 16  2016 spark-sql
<span class="nt">-rwxr-xr-x</span> 1 root root 1050 Nov 16  2016 spark-submit
...
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">spark-shell</code></strong>: 대화형 쉘로 Spark 코드를 실행한다.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">pyspark</code></strong>: PySpark 인터프리터로 Python 코드를 실행한다.</li>
  <li><strong><code class="language-plaintext highlighter-rouge">spark-submit</code></strong>: 클러스터에 애플리케이션을 제출하여 실행한다.</li>
</ul>

<h3 id="스파크-동작-방식"><strong>스파크 동작 방식</strong></h3>

<p>스파크는 논리적 실행 계획을 작성한 후, 이를 최적화하여 물리적 실행 계획으로 변환한다.</p>

<h4 id="1-논리적-실행-계획">1. <strong>논리적 실행 계획</strong></h4>

<p>사용자가 작성한 쿼리나 변환을 바탕으로 생성되는 초기 계획이다. 이 단계에서는 데이터를 어떻게 처리할지 고수준에서 결정한다.</p>

<p><strong>주요 특징</strong></p>

<ul>
  <li><strong>변환의 추상적 표현</strong>: 논리적 실행 계획은 RDD, 데이터프레임, 데이터셋에 적용된 변환(<code class="language-plaintext highlighter-rouge">filter</code>, <code class="language-plaintext highlighter-rouge">map</code>, <code class="language-plaintext highlighter-rouge">join</code> 등)을 추상적으로 표현한다.</li>
  <li><strong>지연 실행</strong>: 사용자가 변환을 호출할 때 즉시 실행되지 않고, 최종 액션이 호출될 때까지 논리적 실행 계획만을 생성한다.</li>
  <li><strong>DAG 생성</strong>: 논리적 실행 계획은 DAG(방향성 비순환 그래프)로 구성되며, 데이터의 흐름을 표현한다.</li>
</ul>

<h4 id="2-물리적-실행-계획">2. <strong>물리적 실행 계획</strong></h4>

<p>논리적 실행 계획을 실제 실행할 수 있는 작업으로 변환한 것이다. 클러스터 자원, 데이터 위치, 네트워크 비용 등을 고려해 최적화되며, 데이터를 분산 처리할 방법을 결정한다.</p>

<p><strong>주요 특징</strong></p>

<ul>
  <li><strong>클러스터 자원 고려</strong>: 물리적 실행 계획은 각 노드에서 연산이 어떻게 수행될지 구체화한다.</li>
  <li><strong>태스크로 분할</strong>: 잡을 스테이지로, 각 스테이지를 여러 태스크로 분할한다.</li>
</ul>

<p><strong>최적화 과정</strong></p>

<ol>
  <li><strong>교환(Shuffle) 최적화</strong>: 데이터를 네트워크를 통해 이동시키는 작업의 비용을 최소화한다.</li>
  <li><strong>파티셔닝 최적화</strong>: 데이터를 최적의 파티션으로 나눠 병렬 처리 성능을 극대화한다.</li>
  <li><strong>병렬 처리 최적화</strong>: 스테이지의 태스크를 여러 노드에서 병렬로 실행하여 처리한다.</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">csv</span><span class="p">(</span><span class="sh">"</span><span class="s">data.csv</span><span class="sh">"</span><span class="p">)</span>      <span class="c1"># 데이터 읽기
</span><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="c1"># 필터링 변환
</span><span class="n">selected_df</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># 선택 변환
</span><span class="n">selected_df</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>                   <span class="c1"># 액션 호출
</span></code></pre></div></div>

<p>위 코드는 <code class="language-plaintext highlighter-rouge">filter</code>와 <code class="language-plaintext highlighter-rouge">select</code> 변환이 적용된 논리적 실행 계획을 만든다. <code class="language-plaintext highlighter-rouge">show()</code> 액션을 호출할 때까지 실제로 실행되지 않지만, 이 시점에 논리적 실행 계획이 DAG로 구성된다.</p>

<p>이 예시에서 <code class="language-plaintext highlighter-rouge">write.csv</code>가 액션으로 호출되면, 스파크는 물리적 실행 계획을 수립하고 데이터를 병렬로 처리한다. 이 과정에서 <strong>Catalyst Optimizer</strong>는 최적의 태스크와 스테이지로 변환 작업을 나누고, 각 워커 노드에 태스크를 할당한다.</p>

<h3 id="catalyst-optimizer의-역할"><strong>Catalyst Optimizer의 역할</strong></h3>

<p><strong>Catalyst Optimizer</strong>는 스파크의 쿼리 최적화 엔진으로, 논리적 실행 계획을 분석해 물리적 실행 계획으로 변환하는 과정에서 최적화를 수행한다. 주요 최적화는 다음과 같다:</p>

<ul>
  <li><strong>프로젝션 푸시다운</strong>: 필요 없는 열을 제거해 메모리와 I/O 비용을 줄인다.</li>
  <li><strong>필터 푸시다운</strong>: 필터링 작업을 데이터 소스에 가까운 단계에서 수행해 불필요한 데이터를 줄인다.</li>
  <li><strong>연산 재배치</strong>: 연산 순서를 재배열해 네트워크 전송을 최소화하고 중복 계산을 피한다.</li>
</ul>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/dataengineering/kafka-classnote/">
                <span class="nav-label">이전 글</span>
                <span class="nav-title">카프카</span>
            </a>
            
            
            
            <a class="next-post" href="/dataengineering/spark-realtime/">
                <span class="nav-label">다음 글</span>
                <span class="nav-title">실시간 데이터 처리와 Spark</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">← 홈으로 돌아가기</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>