<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark 클러스터 구축하기</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- 사이드바 -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>˗ˏˋ ⋆｡𖦹 ˚ 𓇼 ˚｡⋆ ❀˖°</p>
        <p>옛날에 
 데이터 엔지니어가 있엇슨.. 백엔드 서버도 만들고 인프라도 구축하고 데이터 분석도 했슨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    ⠀⠀⠀⠀⠀⠀⢀⡤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢀⡏⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⣀⠴⠋⠉⠉⡆⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠈⠉⠉⠙⠓⠚⠁⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⢀⠞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⠀⠀
    ⠀⠀⠀⠀⡞⠀⠀⠀⠀⠀⠶⠀⠀⠀⠀⠀⠀⠦⠀⠀⠀⠀⠀⠸⡆⠀⠀⠀
    ⢠⣤⣶⣾⣧⣤⣤⣀⡀⠀⠀⠀⠀⠈⠀⠀⠀⢀⡤⠴⠶⠤⢤⡀⣧⣀⣀⠀
    ⠻⠶⣾⠁⠀⠀⠀⠀⠙⣆⠀⠀⠀⠀⠀⠀⣰⠋⠀⠀⠀⠀⠀⢹⣿⣭⣽⠇
    ⠀⠀⠙⠤⠴⢤⡤⠤⠤⠋⠉⠉⠉⠉⠉⠉⠉⠳⠖⠦⠤⠶⠦⠞⠁⠀⠀⠀
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- 메인 콘텐츠 -->
        <main class="main-content">
            <!-- 헤더 -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- 콘텐츠 영역 -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">Spark 클러스터 구축하기</h1>
        <div class="post-meta">
            <time class="post-date">2024년 10월 25일</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">DataEngineering</span>
                    
                
                    
                
                
                <span class="subcategory-tag">spark</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#spark</span>
                
                <span class="tag">#cluster</span>
                
                <span class="tag">#gcp</span>
                
                <span class="tag">#installation</span>
                
                <span class="tag">#distributed-computing</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="gcp-ssh-연결하기">GCP SSH 연결하기</h1>

<ol>
  <li>
    <p>로컬에서 SSH 키 생성<br />
<code class="language-plaintext highlighter-rouge">ssh-keygen -t rsa -f ~/.ssh/gcp -C username</code><br />
gcp에서 유저이름을 못찾아 고생했던 적이 여러번 있어서 아예 옵션을 붙여 <code class="language-plaintext highlighter-rouge">username</code>을 명시적으로 설정해준다.</p>
  </li>
  <li>
    <p>GCP VM 인스턴스 &gt; 메타데이터에 SSH 공개 키 등록</p>
  </li>
  <li>
    <p>SSH 연결<br />
<code class="language-plaintext highlighter-rouge">ssh -i ~/.ssh/gcp username@&lt;external_ip_here&gt;</code>
ssh키 생성시 만든 username을 사용한다.</p>
  </li>
</ol>

<h1 id="클러스터-만들기">클러스터 만들기</h1>

<ol>
  <li>방화벽 규칙 설정<br />
GCP Console에서 VPC 네트워크 &gt; 방화벽 규칙으로 이동한 후, 필요한 포트를 열기 위한 규칙을 생성.</li>
</ol>

<ul>
  <li>트래픽: 인그레스</li>
  <li>대상: 클러스터의 모든 노드에 동일한 태그 할당 후 설정</li>
  <li>소스 IP 범위: 클러스터 내부 통신의 경우 10.0.0.0/8</li>
  <li>프로토콜 및 포트: TCP 22, 7077, 8080, 8081, 4040, 6066 등</li>
</ul>

<ol>
  <li>내부 통신 설정</li>
</ol>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/etc/hosts</code> 파일 설정</li>
  <li><code class="language-plaintext highlighter-rouge">~/.ssh/authorized_keys</code> 파일 설정</li>
</ul>

<p><strong>주의</strong><br />
SSH 키 이름이 <code class="language-plaintext highlighter-rouge">id_rsa</code>가 아니면 SSH 접속 시 문제가 발생할 수 있음.<br />
에러:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh spark01
The authenticity of host 'spark01 (10.178.0.8)' can't be established.
,,,@spark01: Permission denied (publickey).
</code></pre></div></div>

<p>키 이름이 다른 경우, <code class="language-plaintext highlighter-rouge">~/.ssh/config</code> 파일을 설정해야 함.</p>

<h1 id="spark-클러스터-구축하기">spark 클러스터 구축하기</h1>

<h2 id="스파크-클러스터를-구축하는-방법-세가지">스파크 클러스터를 구축하는 방법 세가지!</h2>

<h3 id="1-로컬로-설정하기"><strong>1. 로컬로 설정하기</strong></h3>

<p>각 노드에 스파크를 직접 설치하고, 스탠드얼론 모드로 클러스터를 구성하는 방식</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[노드 1]            [노드 2]            [노드 3]
+-----------+      +-----------+      +-----------+
| Spark     |      | Spark     |      | Spark     |
| Master    |-----&gt;| Worker    |-----&gt;| Worker    |
+-----------+      +-----------+      +-----------+
</code></pre></div></div>

<ul>
  <li><strong>설명</strong>:
    <ul>
      <li><strong>노드 1</strong>: 스파크 <strong>마스터 노드</strong>로 설정한다.</li>
      <li><strong>노드 2, 3</strong>: 스파크 <strong>워커 노드</strong>로 설정하여 마스터 노드에 연결한다.</li>
    </ul>
  </li>
  <li><strong>특징</strong>:
    <ul>
      <li>각 노드에 직접 스파크를 설치하므로 설정이 비교적 간단.</li>
      <li>개발 및 테스트 환경이나 작은 규모의 클러스터에 적합하다.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="2-도커-컨테이너-환경에서-실행하되-수동으로-설정하기"><strong>2. 도커 컨테이너 환경에서 실행하되, 수동으로 설정하기</strong></h3>

<p>각 노드에서 Docker를 사용하여 스파크를 컨테이너로 실행하고, 네트워킹과 설정을 수동으로 구성하는 방식.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[노드 1]            [노드 2]            [노드 3]
+-----------+      +-----------+      +-----------+
| Docker    |      | Docker    |      | Docker    |
| Container |      | Container |      | Container |
| Spark     |      | Spark     |      | Spark     |
| Master    |-----&gt;| Worker    |-----&gt;| Worker    |
+-----------+      +-----------+      +-----------+
</code></pre></div></div>

<ul>
  <li><strong>설명</strong>:
    <ul>
      <li><strong>노드 1</strong>: Docker를 사용하여 스파크 <strong>마스터 컨테이너</strong>를 실행한다.</li>
      <li><strong>노드 2, 3</strong>: Docker를 사용하여 스파크 <strong>워커 컨테이너</strong>를 실행하고 마스터 컨테이너에 연결한다.</li>
    </ul>
  </li>
  <li><strong>특징</strong>:
    <ul>
      <li>컨테이너를 사용하여 일관된 실행 환경을 제공한다.</li>
      <li>네트워크 설정과 컨테이너 관리를 수동으로 해야 하므로 복잡도가 증가할 수 있다.</li>
    </ul>
  </li>
</ul>

<hr />

<h3 id="3-컨테이너-오케스트레이션-툴-사용하기"><strong>3. 컨테이너 오케스트레이션 툴 사용하기</strong></h3>

<p>Docker Swarm이나 Kubernetes와 같은 오케스트레이션 도구를 사용하여 컨테이너 기반의 스파크 클러스터를 자동화하고 관리하는 방식.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                [오케스트레이션 도구]
                        |
        +---------------+---------------+
        |                               |
    [노드 1]                         [노드 2, 3]
    +-----------+                    +-----------+
    | Docker    |                    | Docker    |
    | Container |                    | Container |
    | Spark     |                    | Spark     |
    | Master    |                    | Workers   |
    +-----------+                    +-----------+
</code></pre></div></div>

<ul>
  <li><strong>설명</strong>:
    <ul>
      <li><strong>오케스트레이션 도구</strong>가 여러 노드에 걸쳐 컨테이너를 배포하고 관리한다.</li>
      <li><strong>노드 1</strong>: 스파크 <strong>마스터 컨테이너</strong>를 실행한다.</li>
      <li><strong>노드 2, 3</strong>: 스파크 <strong>워커 컨테이너</strong>를 실행하며, 오케스트레이션 도구가 자동으로 스케일링과 관리를 수행한다.</li>
    </ul>
  </li>
  <li><strong>특징</strong>:
    <ul>
      <li>자동화된 배포, 스케일링, 로드 밸런싱, 장애 복구 등의 기능을 제공한다.</li>
      <li>대규모 클러스터나 프로덕션 환경에 적합.</li>
      <li>초기 설정이 복잡할 수 있지만, 관리 효율성과 확장성이 높다.</li>
    </ul>
  </li>
</ul>

<h2 id="선택-가이드"><strong>선택 가이드</strong></h2>

<ul>
  <li>
    <p><strong>로컬 설정</strong>:</p>

    <ul>
      <li><strong>추천 대상</strong>: 개발 및 테스트 환경, 작은 규모의 프로젝트.</li>
      <li><strong>고려 사항</strong>: 빠른 구축이 가능하지만 수동 관리가 필요하다.</li>
    </ul>
  </li>
  <li>
    <p><strong>도커 수동 설정</strong>:</p>

    <ul>
      <li><strong>추천 대상</strong>: 컨테이너 환경이 필요하지만 오케스트레이션 도구를 사용하지 않는 경우.</li>
      <li><strong>고려 사항</strong>: 컨테이너의 이점을 활용할 수 있지만, 네트워킹과 관리에 대한 추가 작업이 필요하다.</li>
    </ul>
  </li>
  <li>
    <p><strong>오케스트레이션 도구 사용</strong>:</p>
    <ul>
      <li><strong>추천 대상</strong>: 대규모 클러스터, 프로덕션 환경, 자동화된 관리가 필요한 경우.</li>
      <li><strong>고려 사항</strong>: 초기 설정과 학습이 필요하지만, 장기적으로 관리 효율성과 안정성이 높다.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="결론-프로젝트의-규모가-작아-수동으로-설정할-수-있으므로-로컬에서-우선-분석-후-컨테이너-환경으로-마이그레이션-해보도록-하겠다">결론: 프로젝트의 규모가 작아 수동으로 설정할 수 있으므로 로컬에서 우선 분석 후 컨테이너 환경으로 마이그레이션 해보도록 하겠다.</h2>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/dataengineering/spark-data/">
                <span class="nav-label">이전 글</span>
                <span class="nav-title">Spark의 핵심</span>
            </a>
            
            
            
            <a class="next-post" href="/dataengineering/spark-newproject2/">
                <span class="nav-label">다음 글</span>
                <span class="nav-title">Spark 클러스터 구축하기2</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">← 홈으로 돌아가기</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>