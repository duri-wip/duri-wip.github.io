<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangChain Output Parser</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>Ë—ËË‹ â‹†ï½¡ğ–¦¹ Ëš ğ“‡¼ Ëšï½¡â‹† â€Ë–Â°</p>
        <p>ì˜›ë‚ ì— 
 ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ìˆì—‡ìŠ¨.. ë°±ì—”ë“œ ì„œë²„ë„ ë§Œë“¤ê³  ì¸í”„ë¼ë„ êµ¬ì¶•í•˜ê³  ë°ì´í„° ë¶„ì„ë„ í–ˆìŠ¨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    â €â €â €â €â €â €â¢€â¡¤â£¤â£€â €â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €
    â €â €â €â €â €â¢€â¡â €â €â ˆâ ³â£„â €â €â €â €â €â£€â ´â ‹â ‰â ‰â¡†â €â €â €â €â €
    â €â €â €â €â €â¢¸â €â €â €â €â €â ˆâ ‰â ‰â ™â “â šâ â €â €â €â €â£¿â €â €â €â €â €
    â €â €â €â €â¢€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¹â£„â €â €â €â €
    â €â €â €â €â¡â €â €â €â €â €â ¶â €â €â €â €â €â €â ¦â €â €â €â €â €â ¸â¡†â €â €â €
    â¢ â£¤â£¶â£¾â£§â£¤â£¤â£€â¡€â €â €â €â €â ˆâ €â €â €â¢€â¡¤â ´â ¶â ¤â¢¤â¡€â£§â£€â£€â €
    â »â ¶â£¾â â €â €â €â €â ™â£†â €â €â €â €â €â €â£°â ‹â €â €â €â €â €â¢¹â£¿â£­â£½â ‡
    â €â €â ™â ¤â ´â¢¤â¡¤â ¤â ¤â ‹â ‰â ‰â ‰â ‰â ‰â ‰â ‰â ³â –â ¦â ¤â ¶â ¦â â â €â €â €
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">LangChain Output Parser</h1>
        <div class="post-meta">
            <time class="post-date">2025ë…„ 07ì›” 11ì¼</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">ML-AI</span>
                    
                
                    
                
                
                <span class="subcategory-tag">llm</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#genai-llm</span>
                
                <span class="tag">#langchain</span>
                
                <span class="tag">#output-parser</span>
                
                <span class="tag">#pydantic</span>
                
                <span class="tag">#study-llm-framework</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="ì•„ì›ƒí’‹-í˜•ì‹-ì§€ì •í•˜ê¸°--output-parser">ì•„ì›ƒí’‹ í˜•ì‹ ì§€ì •í•˜ê¸° : Output Parser</h1>

<p>llm ì´ ë‚´ë±‰ëŠ” ë‹µë³€ ìì²´ë¥¼ ì„œë¹„ìŠ¤ì—ì„œ ë§ˆì§€ë§‰ ë‹¨ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì›Œí¬í”Œë¡œìš°ëŠ” ì´ì œ í”í•˜ì§€ ì•Šë‹¤.
ai í”„ë¡œë•íŠ¸ê°€ ë‹¤ì–‘í•´ì§€ë©´ì„œ ì›Œí¬í”Œë¡œìš°ê°€ ë³µì¡í•´ì§€ê³  ìˆìœ¼ë¯€ë¡œ, 1ë²ˆ ë…¸ë“œì—ì„œ ë°›ì€ ì‘ë‹µì„ ê°€ê³µí•´ì„œ 2ë²ˆì— ì¸í’‹ìœ¼ë¡œ ë„£ê³ .. í•˜ëŠ” ê³¼ì •ì´ ë§ì•„ì§€ê¸° ë•Œë¬¸ì´ë‹¤.
ì´ëŸ° ê³¼ì •ì—ì„œ ì–¸ì œë‚˜ ëª¨ë¸ì— ë§ì¶°ì„œ ë‹¤ì‹œ íŒŒì‹±í•˜ê³ .. íƒ€ì… ìœ íš¨ì„± ê²€ì¦í•˜ê³ .. í•˜ëŠ” ê³¼ì •ì„ ì†ìˆ˜ í•˜ë‚˜í•˜ë‚˜ ë§Œë“œëŠ”ê±´ ì •ë§ ì‰½ì§€ ì•Šë‹¤.
ê·¸ë˜ì„œ ì•„ì›ƒí’‹ íŒŒì„œëŠ” ë­ì²´ì¸ í”„ë ˆì„ì›Œí¬ì—ì„œ ìœ ìš©í•˜ê²Œ ì˜ ì“°ê³  ìˆëŠ” ê¸°ëŠ¥ì´ë‹¤.</p>

<h2 id="pydantic-output-parser-ì‚¬ìš©ë²•">Pydantic Output Parser ì‚¬ìš©ë²•</h2>

<p>PydanticOutputParserëŠ” langchainì˜ output parser ì¤‘ í•˜ë‚˜ë¡œ LLM ì¶œë ¥ì„ íŒŒì´ì¬ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì¶œë ¥í•˜ê²Œ í•  í˜•ì‹ì„ pydantic ëª¨ë¸ë¡œ ì§€ì •
</span><span class="kn">from</span> <span class="n">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">country</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="sh">"</span><span class="s">The country the city is in</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span> <span class="o">=</span> <span class="sh">"</span><span class="s">The city name</span><span class="sh">"</span><span class="p">)</span>


<span class="c1"># pydantic ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” í”„ë¡¬í”„íŠ¸ ì‘ì„±
</span><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">PydanticOutputParser</span>

<span class="n">output_parser</span> <span class="o">=</span> <span class="nc">PydanticOutputParser</span><span class="p">(</span><span class="n">pydantic_object</span> <span class="o">=</span> <span class="n">City</span><span class="p">)</span>

<span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="p">.</span><span class="nf">get_format_instructions</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">format_instructions</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_messages</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">system</span><span class="sh">"</span><span class="p">,</span>
     <span class="sh">"</span><span class="s">ì‚¬ìš©ìê°€ ì…ë ¥í•œ êµ­ê°€ì˜ ìˆ˜ë„ë¥¼ ì¶œë ¥í•´ì£¼ì„¸ìš”.</span><span class="sh">"</span><span class="p">,</span>
     <span class="sh">"</span><span class="s">{format_instructions}</span><span class="sh">"</span><span class="p">),</span>
     <span class="p">(</span><span class="sh">"</span><span class="s">human</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">{input}</span><span class="sh">"</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">prompt_value</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">.</span><span class="nf">partial</span><span class="p">(</span>
    <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">format_instructions</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>output í˜•ì‹ì„ pydantic objectë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ êµ¬ì¡°í™”, í˜•ì‹ ê²€ì¦ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.</li>
</ul>

<p>-&gt; ê²°ê³¼ í™•ì¸í•´ë³´ê¸°</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prompt.invoke({"input": "France"})
print(prompt_value.messages[0].content)
print(prompt_value.messages[1].content)
</code></pre></div></div>

<h2 id="string-output-parser-ì‚¬ìš©ë²•">String Output Parser ì‚¬ìš©ë²•</h2>

<p>LLMì˜ ì¶œë ¥ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="n">langchain_core.messages</span> <span class="kn">import</span> <span class="n">AIMessage</span><span class="p">,</span> <span class="n">HumanMessage</span>

<span class="n">output_parser</span> <span class="o">=</span> <span class="nc">StrOutputParser</span><span class="p">()</span>

<span class="n">ai_message</span> <span class="o">=</span> <span class="nc">AIMessage</span><span class="p">(</span><span class="n">content</span> <span class="o">=</span> <span class="sh">"</span><span class="s">The capital of France is Paris.</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ai_message</span> <span class="o">=</span> <span class="n">output_parser</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">ai_message</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">ai_message</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="jsonoutputparser">JsonOutputParser</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">JsonOutputParser</span>
<span class="kn">from</span> <span class="n">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">Recipe</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ìš”ë¦¬ ì´ë¦„</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">ingredients</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì¬ë£Œ ëª©ë¡</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">steps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì¡°ë¦¬ ê³¼ì •</span><span class="sh">"</span><span class="p">)</span>

<span class="n">parser</span> <span class="o">=</span> <span class="nc">JsonOutputParser</span><span class="p">(</span><span class="n">pydantic_object</span><span class="o">=</span><span class="n">Recipe</span><span class="p">)</span>

<span class="c1"># í”„ë¡¬í”„íŠ¸ì— í¬ë§· ì§€ì‹œì‚¬í•­ ìë™ ì¶”ê°€
</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">ì‚¬ìš©ì ì§ˆë¬¸: {query}</span><span class="se">\n</span><span class="s">{format_instructions}</span><span class="sh">"</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="pydantic-output-parser-ë‘-json-output-parserì˜-ì°¨ì´ì ">pydantic output parser ë‘ json output parserì˜ ì°¨ì´ì </h3>

<p><strong>PydanticOutputParser:</strong></p>

<ul>
  <li>Pydantic ëª¨ë¸ ê¸°ë°˜ ê²€ì¦</li>
  <li>íƒ€ì… ì•ˆì „ì„± ë³´ì¥</li>
  <li>ë³µì¡í•œ ì¤‘ì²© êµ¬ì¡° ì§€ì›</li>
  <li>ìë™ í•„ë“œ ê²€ì¦</li>
</ul>

<p><strong>JsonOutputParser:</strong></p>

<ul>
  <li>ë‹¨ìˆœ JSON íŒŒì‹±</li>
  <li>Pydantic ëª¨ë¸ ì„ íƒì  ì‚¬ìš©</li>
  <li>ë” ë¹ ë¥¸ ì²˜ë¦¬ ì†ë„</li>
  <li>ìœ ì—°í•œ êµ¬ì¡°</li>
</ul>

<h2 id="commaseparatedlistoutputparser">CommaSeparatedListOutputParser</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">CommaSeparatedListOutputParser</span>

<span class="n">output_parser</span> <span class="o">=</span> <span class="nc">CommaSeparatedListOutputParser</span><span class="p">()</span>
<span class="n">format_instructions</span> <span class="o">=</span> <span class="n">output_parser</span><span class="p">.</span><span class="nf">get_format_instructions</span><span class="p">()</span>
<span class="c1"># ê²°ê³¼: "Your response should be a list of comma separated values, eg: `foo, bar, baz`"
</span></code></pre></div></div>

<h2 id="datetimeoutputparser">DatetimeOutputParser</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">DatetimeOutputParser</span>

<span class="n">output_parser</span> <span class="o">=</span> <span class="nc">DatetimeOutputParser</span><span class="p">()</span>
<span class="c1"># ISO 8601 í˜•ì‹ì˜ datetime ê°ì²´ë¡œ ë³€í™˜
</span></code></pre></div></div>

<h1 id="2-custom-output-parser-ë§Œë“¤ê¸°">2. Custom Output Parser ë§Œë“¤ê¸°</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">BaseOutputParser</span>
<span class="kn">from</span> <span class="n">langchain_core.exceptions</span> <span class="kn">import</span> <span class="n">OutputParserException</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="k">class</span> <span class="nc">EmailListParser</span><span class="p">(</span><span class="n">BaseOutputParser</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
    <span class="sh">"""</span><span class="s">ì´ë©”ì¼ ì£¼ì†Œ ëª©ë¡ì„ íŒŒì‹±í•˜ëŠ” ì»¤ìŠ¤í…€ íŒŒì„œ</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># ì´ë©”ì¼ íŒ¨í„´ ì •ê·œì‹
</span>        <span class="n">email_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b</span><span class="sh">'</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">email_pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">emails</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">OutputParserException</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">No valid emails found in: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">emails</span>

    <span class="k">def</span> <span class="nf">get_format_instructions</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">ì‘ë‹µì—ëŠ” ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë“¤ì„ í¬í•¨í•´ì£¼ì„¸ìš”.</span><span class="sh">"</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ
</span><span class="n">email_parser</span> <span class="o">=</span> <span class="nc">EmailListParser</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>ì‘ë‹µì„ íŒŒì‹±í•˜ëŠ”ê±¸ ë­ì²´ì¸ì˜ runnable ê°ì²´ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë­ì²´ì¸ í”„ë ˆì„ì›Œí¬ ë°–ì—ì„œ ì´ëŸ° ì‘ì—…ì„ í•˜ë ¤ê³  í•˜ë©´ ì‘ë‹µì˜ ìœ íš¨ì„±ë¶€í„° ì˜ˆì™¸ì²˜ë¦¬ê¹Œì§€ ë‹¤ í•˜ë‚˜í•˜ë‚˜ ë§Œë“¤ì–´ì¤˜ì•¼ê²Ÿì§€ . . .</li>
</ul>

<h1 id="3-output-parserì™€-pydantic-ê³ ê¸‰-í™œìš©">3. Output Parserì™€ Pydantic ê³ ê¸‰ í™œìš©</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">validator</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Priority</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="sh">"</span><span class="s">high</span><span class="sh">"</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="sh">"</span><span class="s">medium</span><span class="sh">"</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="sh">"</span><span class="s">low</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">Task</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì‘ì—… ì œëª©</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì‘ì—… ì„¤ëª…</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Priority</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì‘ì—… ìš°ì„ ìˆœìœ„</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">due_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ë§ˆê°ì¼ (YYYY-MM-DD)</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">"</span><span class="s">ì‘ì—… íƒœê·¸ ëª©ë¡</span><span class="sh">"</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="sh">'</span><span class="s">due_date</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_date_format</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="n">datetime</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">strptime</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="sh">'</span><span class="s">%Y-%m-%d</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">'</span><span class="s">ë‚ ì§œëŠ” YYYY-MM-DD í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></div>

<h3 id="2-format-instructionsì˜-ì¤‘ìš”ì„±">2. Format Instructionsì˜ ì¤‘ìš”ì„±</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì˜ëª»ëœ ì˜ˆì‹œ
</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span><span class="sh">"</span><span class="s">ë‚ ì”¨ ì •ë³´ë¥¼ JSONìœ¼ë¡œ ì£¼ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">ë‚ ì”¨ ì •ë³´ë¥¼ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì£¼ì„¸ìš”:</span><span class="se">\n</span><span class="s">{format_instructions}</span><span class="se">\n</span><span class="s">ì§ˆë¬¸: {query}</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">.</span><span class="nf">partial</span><span class="p">(</span><span class="n">format_instructions</span><span class="o">=</span><span class="n">parser</span><span class="p">.</span><span class="nf">get_format_instructions</span><span class="p">())</span>
</code></pre></div></div>

<p>ë‘ ê°€ì§€ ë°©ì‹ ëª¨ë‘ í˜•ì‹ì— ëŒ€í•œ ì¸ìŠ¤íŠ¸ëŸ­ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ë§Œ ê°•ì œì„±ì´ ìˆëŠ” ë°©ì‹ì´ ì–¸ì œë‚˜ ë” ë‚«ìŠµë‹ˆë‹¤.. llmì€ ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ê¸°ë„ í•˜ë‹ˆê¹Œìš”â€¦</p>

<h3 id="3-íŒŒì‹±-ì—ëŸ¬-ì²˜ë¦¬-ì „ëµ">3. íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">OutputFixingParser</span>
<span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="c1"># ìë™ ìˆ˜ì • íŒŒì„œ
</span><span class="n">fixing_parser</span> <span class="o">=</span> <span class="n">OutputFixingParser</span><span class="p">.</span><span class="nf">from_llm</span><span class="p">(</span>
    <span class="n">parser</span><span class="o">=</span><span class="nc">PydanticOutputParser</span><span class="p">(</span><span class="n">pydantic_object</span><span class="o">=</span><span class="n">Recipe</span><span class="p">),</span>
    <span class="n">llm</span><span class="o">=</span><span class="nc">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># ì¬ì‹œë„ íŒŒì„œ
</span><span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">RetryOutputParser</span>

<span class="n">retry_parser</span> <span class="o">=</span> <span class="n">RetryOutputParser</span><span class="p">.</span><span class="nf">from_llm</span><span class="p">(</span>
    <span class="n">parser</span><span class="o">=</span><span class="nc">PydanticOutputParser</span><span class="p">(</span><span class="n">pydantic_object</span><span class="o">=</span><span class="n">Recipe</span><span class="p">),</span>
    <span class="n">llm</span><span class="o">=</span><span class="nc">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">retry_parser</span><span class="p">.</span><span class="nf">parse_with_prompt</span><span class="p">(</span><span class="n">malformed_output</span><span class="p">,</span> <span class="n">original_prompt</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># ìµœì¢… ì‹¤íŒ¨ ì²˜ë¦¬
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">íŒŒì‹± ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-ì„±ëŠ¥-ìµœì í™”-íŒ">4. ì„±ëŠ¥ ìµœì í™” íŒ</h3>

<p><strong>1. ê°„ë‹¨í•œ êµ¬ì¡° ì„ í˜¸:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë³µì¡í•œ ì¤‘ì²©ë³´ë‹¤ëŠ” í‰ë©´ì  êµ¬ì¡°
</span><span class="k">class</span> <span class="nc">SimpleTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">completed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre></div></div>

<p><strong>2. ì„ íƒì  í•„ë“œ í™œìš©:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FlexibleResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">required_field</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">optional_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># LLMì´ ìƒëµ ê°€ëŠ¥
</span></code></pre></div></div>

<p><strong>3. Enum í™œìš©ìœ¼ë¡œ ê°’ ì œí•œ:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="sh">"</span><span class="s">pending</span><span class="sh">"</span>
    <span class="n">IN_PROGRESS</span> <span class="o">=</span> <span class="sh">"</span><span class="s">in_progress</span><span class="sh">"</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">completed</span><span class="sh">"</span>
</code></pre></div></div>

<h3 id="5-ì‹¤ì œ-í”„ë¡œë•ì…˜-í™˜ê²½ì—ì„œì˜-ì£¼ì˜ì‚¬í•­">5. ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œì˜ ì£¼ì˜ì‚¬í•­</h3>

<p><strong>í† í° ë¹„ìš© ê³ ë ¤:</strong></p>

<ul>
  <li>ë³µì¡í•œ format_instructionsëŠ” í† í°ì„ ë§ì´ ì†Œëª¨</li>
  <li>ìì£¼ ì‚¬ìš©ë˜ëŠ” íŒŒì„œëŠ” ìºì‹± ê³ ë ¤</li>
</ul>

<p><strong>ì—ëŸ¬ ë³µêµ¬:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">robust_parse</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OutputParserException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_attempts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># ë§ˆì§€ë§‰ ì‹œë„ ì‹¤íŒ¨ì‹œ ê¸°ë³¸ê°’ ë˜ëŠ” ë¶€ë¶„ íŒŒì‹± ê²°ê³¼ ë°˜í™˜
</span>                <span class="k">return</span> <span class="nf">extract_partial_data</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="c1"># ë‹¤ìŒ ì‹œë„ë¥¼ ìœ„í•œ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
</span>            <span class="n">text</span> <span class="o">=</span> <span class="nf">preprocess_for_retry</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ë¡œê¹…ê³¼ ëª¨ë‹ˆí„°ë§:</strong></p>

<ul>
  <li>íŒŒì‹± ì‹¤íŒ¨ìœ¨ ì¶”ì </li>
  <li>ìì£¼ ì‹¤íŒ¨í•˜ëŠ” íŒ¨í„´ ë¶„ì„</li>
  <li>LLM ì‘ë‹µ í’ˆì§ˆ ê°œì„ ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì¡°ì •</li>
</ul>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/ml-ai/langchain-framework/">
                <span class="nav-label">ì´ì „ ê¸€</span>
                <span class="nav-title">langchain í”„ë ˆì„ì›Œí¬</span>
            </a>
            
            
            
            <a class="next-post" href="/ml-ai/LCEL/">
                <span class="nav-label">ë‹¤ìŒ ê¸€</span>
                <span class="nav-title">LCEL (LangChain Expression ...</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>