<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG ì‹œìŠ¤í…œ í‰ê°€í•˜ê¸°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>Ë—ËË‹ â‹†ï½¡ğ–¦¹ Ëš ğ“‡¼ Ëšï½¡â‹† â€Ë–Â°</p>
        <p>ì˜›ë‚ ì— 
 ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ìˆì—‡ìŠ¨.. ë°±ì—”ë“œ ì„œë²„ë„ ë§Œë“¤ê³  ì¸í”„ë¼ë„ êµ¬ì¶•í•˜ê³  ë°ì´í„° ë¶„ì„ë„ í–ˆìŠ¨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    â €â €â €â €â €â €â¢€â¡¤â£¤â£€â €â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €
    â €â €â €â €â €â¢€â¡â €â €â ˆâ ³â£„â €â €â €â €â €â£€â ´â ‹â ‰â ‰â¡†â €â €â €â €â €
    â €â €â €â €â €â¢¸â €â €â €â €â €â ˆâ ‰â ‰â ™â “â šâ â €â €â €â €â£¿â €â €â €â €â €
    â €â €â €â €â¢€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¹â£„â €â €â €â €
    â €â €â €â €â¡â €â €â €â €â €â ¶â €â €â €â €â €â €â ¦â €â €â €â €â €â ¸â¡†â €â €â €
    â¢ â£¤â£¶â£¾â£§â£¤â£¤â£€â¡€â €â €â €â €â ˆâ €â €â €â¢€â¡¤â ´â ¶â ¤â¢¤â¡€â£§â£€â£€â €
    â »â ¶â£¾â â €â €â €â €â ™â£†â €â €â €â €â €â €â£°â ‹â €â €â €â €â €â¢¹â£¿â£­â£½â ‡
    â €â €â ™â ¤â ´â¢¤â¡¤â ¤â ¤â ‹â ‰â ‰â ‰â ‰â ‰â ‰â ‰â ³â –â ¦â ¤â ¶â ¦â â â €â €â €
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">RAG ì‹œìŠ¤í…œ í‰ê°€í•˜ê¸°</h1>
        <div class="post-meta">
            <time class="post-date">2025ë…„ 07ì›” 31ì¼</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">ML-AI</span>
                    
                
                    
                
                
                <span class="subcategory-tag">rag</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#genai-llm</span>
                
                <span class="tag">#langchain</span>
                
                <span class="tag">#rag</span>
                
                <span class="tag">#vector-store</span>
                
                <span class="tag">#embedding</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="rag-ì‹œìŠ¤í…œ-í‰ê°€">RAG ì‹œìŠ¤í…œ í‰ê°€</h1>

<p>RAG ì‹œìŠ¤í…œì˜ í‰ê°€ëŠ” <strong>ì˜¤í”„ë¼ì¸ í‰ê°€</strong>ì™€ <strong>ì˜¨ë¼ì¸ í‰ê°€</strong>ê°€ ìˆìŠµë‹ˆë‹¤. ì˜¨ë¼ì¸ í‰ê°€ëŠ” ì‚¬ìš©ì í”¼ë“œë°±ì— ì˜í•œ í”¼ë“œë°± ë£¨í”„ë¥¼ íƒ€ëŠ” ë‚´ìš©ì´ë¯€ë¡œ ì˜¤í”„ë¼ì¸ í‰ê°€ì— ëŒ€í•´ì„œë§Œ ë‹¤ë£¹ë‹ˆë‹¤.</p>

<h2 id="1-ragas-rag-assessment">1. RAGAS (RAG Assessment)</h2>

<p>RAGASëŠ” RAG ì‹œìŠ¤í…œì„ í‰ê°€í•˜ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ë¡œ, ë‹¤ì–‘í•œ í‰ê°€ ë©”íŠ¸ë¦­ì„ ì œê³µí•©ë‹ˆë‹¤.</p>

<h3 id="ê²€ìƒ‰-ê´€ë ¨-ë©”íŠ¸ë¦­">ê²€ìƒ‰ ê´€ë ¨ ë©”íŠ¸ë¦­</h3>

<h4 id="1-ì½˜í…ìŠ¤íŠ¸-ì •ë°€ë„-context-precision">1. ì½˜í…ìŠ¤íŠ¸ ì •ë°€ë„ (Context Precision)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì§ˆë¬¸ê³¼ ê¸°ëŒ€í•˜ëŠ” ë‹µë³€ì„ ê³ ë ¤í•´ ì‹¤ì œ ê²€ìƒ‰ ê²°ê³¼ ì¤‘ ìœ ìš©í•˜ë‹¤ê³  LLMì´ ì¶”ë¡ í•˜ëŠ” ë¹„ìœ¨</li>
  <li><strong>ì¸¡ì •</strong>: ê²€ìƒ‰ëœ ë¬¸ì„œ ì¤‘ ì‹¤ì œë¡œ ë‹µë³€ì— ë„ì›€ì´ ë˜ëŠ” ë¬¸ì„œì˜ ë¹„ìœ¨</li>
</ul>

<h4 id="2-ì½˜í…ìŠ¤íŠ¸-ì¬í˜„ìœ¨-context-recall">2. ì½˜í…ìŠ¤íŠ¸ ì¬í˜„ìœ¨ (Context Recall)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ê¸°ëŒ€í•˜ëŠ” ë‹µë³€ì„ ì—¬ëŸ¬ ë¬¸ì¥ìœ¼ë¡œ ë‚˜ëˆ´ì„ ë•Œ ì‹¤ì œ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” ë¹„ìœ¨</li>
  <li><strong>ì¸¡ì •</strong>: ì •ë‹µì— í¬í•¨ëœ ì •ë³´ ì¤‘ ê²€ìƒ‰ëœ ë¬¸ì„œì—ì„œ ì°¾ì„ ìˆ˜ ìˆëŠ” ì •ë³´ì˜ ë¹„ìœ¨</li>
</ul>

<h4 id="3-ì½˜í…ìŠ¤íŠ¸-ì—”í‹°í‹°-ì¬í˜„ìœ¨-context-entity-recall">3. ì½˜í…ìŠ¤íŠ¸ ì—”í‹°í‹° ì¬í˜„ìœ¨ (Context Entity Recall)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ê¸°ëŒ€í•˜ëŠ” ë‹µë³€ì— í¬í•¨ëœ ì—”í‹°í‹°(ê°œì²´) ì¤‘ ì‹¤ì œ ê²€ìƒ‰ ê²°ê³¼ì— í¬í•¨ëœ ë¹„ìœ¨</li>
  <li><strong>ì¸¡ì •</strong>: ì •ë‹µì˜ í•µì‹¬ ì—”í‹°í‹° ì¤‘ ê²€ìƒ‰ ë¬¸ì„œì—ì„œ ë°œê²¬ë˜ëŠ” ì—”í‹°í‹°ì˜ ë¹„ìœ¨</li>
</ul>

<h3 id="ìƒì„±-ê´€ë ¨-ë©”íŠ¸ë¦­">ìƒì„± ê´€ë ¨ ë©”íŠ¸ë¦­</h3>

<h4 id="1-ë‹µë³€-ê´€ë ¨ì„±-answer-relevancy">1. ë‹µë³€ ê´€ë ¨ì„± (Answer Relevancy)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì‹¤ì œ ë‹µë³€ì´ ì§ˆë¬¸ê³¼ ì–¼ë§ˆë‚˜ ê´€ë ¨ë˜ëŠ”ì§€ ì¸¡ì •</li>
  <li><strong>ê³„ì‚°</strong>: ì‹¤ì œ ë‹µë³€ì—ì„œ LLMìœ¼ë¡œ ì¶”ë¡ í•œ ì§ˆë¬¸ê³¼ ì›ë˜ ì§ˆë¬¸ì˜ ì„ë² ë”© ë²¡í„° ì½”ì‚¬ì¸ ìœ ì‚¬ë„ í‰ê· ê°’</li>
</ul>

<h4 id="2-ì¶©ì‹¤ì„±-faithfulness">2. ì¶©ì‹¤ì„± (Faithfulness)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì‹¤ì œ ë‹µë³€ì— í¬í•¨ëœ ì£¼ì¥ ì¤‘ ì‹¤ì œ ê²€ìƒ‰ ê²°ê³¼ì™€ ì¼ê´€ëœ ë¹„ìœ¨</li>
  <li><strong>ì¸¡ì •</strong>: ìƒì„±ëœ ë‹µë³€ì´ ê²€ìƒ‰ëœ ë¬¸ì„œì˜ ë‚´ìš©ê³¼ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ì§€ í‰ê°€</li>
</ul>

<h3 id="ê²€ìƒ‰--ìƒì„±-í†µí•©-ë©”íŠ¸ë¦­">ê²€ìƒ‰ + ìƒì„± í†µí•© ë©”íŠ¸ë¦­</h3>

<h4 id="1-ë‹µë³€-ìœ ì‚¬ì„±-answer-similarity">1. ë‹µë³€ ìœ ì‚¬ì„± (Answer Similarity)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì‹¤ì œ ë‹µë³€ê³¼ ê¸°ëŒ€í•˜ëŠ” ë‹µë³€ì˜ ì„ë² ë”© ë²¡í„° ì½”ì‚¬ì¸ ìœ ì‚¬ë„</li>
  <li><strong>ì¸¡ì •</strong>: ìƒì„±ëœ ë‹µë³€ê³¼ ì •ë‹µ ì‚¬ì´ì˜ ì˜ë¯¸ì  ìœ ì‚¬ë„</li>
</ul>

<h4 id="2-ë‹µë³€-ì •í™•ì„±-answer-correctness">2. ë‹µë³€ ì •í™•ì„± (Answer Correctness)</h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì‹¤ì œ ë‹µë³€ê³¼ ê¸°ëŒ€í•˜ëŠ” ë‹µë³€ì˜ ì‚¬ì‹¤ì  ìœ ì‚¬ì„±ê³¼ ì˜ë¯¸ì  ìœ ì‚¬ì„±ì˜ ê°€ì¤‘ í‰ê· </li>
  <li><strong>ì¸¡ì •</strong>: ì •í™•ì„±ê³¼ ì™„ì „ì„±ì„ ëª¨ë‘ ê³ ë ¤í•œ ì¢…í•©ì  í‰ê°€ ì§€í‘œ</li>
</ul>

<p>ì´ëŸ¬í•œ ë©”íŠ¸ë¦­ë“¤ì„ í†µí•´ RAG ì‹œìŠ¤í…œì˜ ê²€ìƒ‰ í’ˆì§ˆê³¼ ìƒì„± í’ˆì§ˆì„ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="-ì¶”ê°€ë¡œ-ì•Œì•„ë³¼-ë‚´ìš©">ğŸ“š ì¶”ê°€ë¡œ ì•Œì•„ë³¼ ë‚´ìš©</h2>

<h3 id="1-ê³ ê¸‰-í‰ê°€-ë©”íŠ¸ë¦­">1. ê³ ê¸‰ í‰ê°€ ë©”íŠ¸ë¦­</h3>

<p><strong>Custom Evaluation Metrics:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="c1"># ë„ë©”ì¸ë³„ ë§ì¶¤ í‰ê°€
</span><span class="k">class</span> <span class="nc">CustomRAGEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="sh">"</span><span class="s">general</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">self</span><span class="p">.</span><span class="n">evaluator_llm</span> <span class="o">=</span> <span class="nc">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate_domain_relevance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span><span class="sh">"""</span><span class="s">
        ë„ë©”ì¸: {domain}
        ì§ˆë¬¸: {question}
        ë‹µë³€: {answer}
        ì»¨í…ìŠ¤íŠ¸: {context}
        
        ì´ ë‹µë³€ì´ {domain} ë„ë©”ì¸ì—ì„œ ì–¼ë§ˆë‚˜ ì ì ˆí•œì§€ 1-10ì ìœ¼ë¡œ í‰ê°€í•˜ê³  ì´ìœ ë¥¼ ì„¤ëª…í•˜ì„¸ìš”.
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="n">evaluation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">evaluator_llm</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">domain</span><span class="p">,</span>
            <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
            <span class="n">answer</span><span class="o">=</span><span class="n">answer</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span>
        <span class="p">))</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_score</span><span class="p">(</span><span class="n">evaluation</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Retrieval Quality Metrics:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="k">class</span> <span class="nc">RetrievalQualityEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">embeddings_model</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings_model</span>
    
    <span class="k">def</span> <span class="nf">calculate_mrr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Mean Reciprocal Rank ê³„ì‚°</span><span class="sh">"""</span>
        <span class="n">mrr_scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">query</span><span class="p">,</span> <span class="n">retrieved</span><span class="p">,</span> <span class="n">relevant</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
                    <span class="n">mrr_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">rank</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mrr_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mrr_scores</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">calculate_ndcg</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevance_scores</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Normalized Discounted Cumulative Gain ê³„ì‚°</span><span class="sh">"""</span>
        <span class="n">ndcg_scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">query_idx</span><span class="p">,</span> <span class="n">retrieved</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">):</span>
            <span class="n">dcg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">idcg</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="c1"># ì‹¤ì œ ìˆœì„œì˜ DCG ê³„ì‚°
</span>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved</span><span class="p">[:</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">relevance</span> <span class="o">=</span> <span class="n">relevance_scores</span><span class="p">[</span><span class="n">query_idx</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">dcg</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">relevance</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># ì´ìƒì  ìˆœì„œì˜ IDCG ê³„ì‚°
</span>            <span class="n">ideal_relevances</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">relevance_scores</span><span class="p">[</span><span class="n">query_idx</span><span class="p">].</span><span class="nf">values</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rel</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ideal_relevances</span><span class="p">):</span>
                <span class="n">idcg</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">rel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="n">ndcg_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">dcg</span> <span class="o">/</span> <span class="n">idcg</span> <span class="k">if</span> <span class="n">idcg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">ndcg_scores</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-ìë™í™”ëœ-í‰ê°€-íŒŒì´í”„ë¼ì¸">2. ìë™í™”ëœ í‰ê°€ íŒŒì´í”„ë¼ì¸</h3>

<p><strong>Continuous Evaluation:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">schedule</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">ContinuousRAGEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rag_chain</span><span class="p">,</span> <span class="n">test_dataset</span><span class="p">,</span> <span class="n">evaluators</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rag_chain</span> <span class="o">=</span> <span class="n">rag_chain</span>
        <span class="n">self</span><span class="p">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span>
        <span class="n">self</span><span class="p">.</span><span class="n">evaluators</span> <span class="o">=</span> <span class="n">evaluators</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results_history</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">run_evaluation</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì •ê¸° í‰ê°€ ì‹¤í–‰</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting evaluation at </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        
        <span class="c1"># ê° í‰ê°€ìë³„ë¡œ ë©”íŠ¸ë¦­ ê³„ì‚°
</span>        <span class="k">for</span> <span class="n">evaluator_name</span><span class="p">,</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">evaluators</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metric_score</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">rag_chain</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">test_dataset</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">][</span><span class="n">evaluator_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_score</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">evaluator_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">metric_score</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error in </span><span class="si">{</span><span class="n">evaluator_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">][</span><span class="n">evaluator_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_check_performance_degradation</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_check_performance_degradation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„±ëŠ¥ ì €í•˜ ê°ì§€</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">current</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_score</span> <span class="ow">in</span> <span class="n">current</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_score</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">previous</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">degradation</span> <span class="o">=</span> <span class="n">previous</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_score</span>
            <span class="k">if</span> <span class="n">degradation</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_alert_performance_issue</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">degradation</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">schedule_evaluations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">interval_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì •ê¸° í‰ê°€ ìŠ¤ì¼€ì¤„ë§</span><span class="sh">"""</span>
        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">(</span><span class="n">interval_hours</span><span class="p">).</span><span class="n">hours</span><span class="p">.</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">run_evaluation</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">schedule</span><span class="p">.</span><span class="nf">run_pending</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 1ì‹œê°„ë§ˆë‹¤ ì²´í¬
</span></code></pre></div></div>

<h3 id="3-ë²¤ì¹˜ë§ˆí¬-ë°ì´í„°ì…‹-í™œìš©">3. ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°ì…‹ í™œìš©</h3>

<p><strong>Popular RAG Benchmarks:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MS MARCO ë°ì´í„°ì…‹ í™œìš©
</span><span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="k">class</span> <span class="nc">BenchmarkEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">ms_marco</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_ms_marco</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">natural_questions</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_nq</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">hotpot_qa</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_hotpot</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_load_ms_marco</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">ms_marco</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">v1.1</span><span class="sh">"</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="sh">"</span><span class="s">validation</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span>
            <span class="sh">'</span><span class="s">question</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">expected_answer</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">answers</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">answers</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">''</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">context</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">passages</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))]</span>
    
    <span class="k">def</span> <span class="nf">evaluate_on_benchmark</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rag_chain</span><span class="p">,</span> <span class="n">benchmark_name</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°ì…‹ìœ¼ë¡œ í‰ê°€</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">benchmark_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unknown benchmark: </span><span class="si">{</span><span class="n">benchmark_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span><span class="p">[</span><span class="n">benchmark_name</span><span class="p">]</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">benchmark_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">rag_chain</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span><span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">question</span><span class="sh">'</span><span class="p">]})</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_similarity</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">expected_answer</span><span class="sh">'</span><span class="p">])</span>
                <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error processing question: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">benchmark</span><span class="sh">'</span><span class="p">:</span> <span class="n">benchmark_name</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">average_score</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_questions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">benchmark_data</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">successful_answers</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scores</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="-í•™ìŠµí•˜ë©´ì„œ-ì•Œê²Œ-ëœ-ì ">ğŸ” í•™ìŠµí•˜ë©´ì„œ ì•Œê²Œ ëœ ì </h2>

<h3 id="1-ragas-ë©”íŠ¸ë¦­ì˜-ì‹¤ì œ-í•´ì„">1. RAGAS ë©”íŠ¸ë¦­ì˜ ì‹¤ì œ í•´ì„</h3>

<p><strong>Context Precisionì˜ í•¨ì •:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Context Precisionì´ ë†’ë‹¤ê³  í•­ìƒ ì¢‹ì€ ê²ƒì€ ì•„ë‹˜
</span><span class="k">def</span> <span class="nf">analyze_context_precision</span><span class="p">():</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">ë†’ì€_ì •ë°€ë„_ì¢‹ì€_ê²½ìš°</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œë§Œ ê²€ìƒ‰</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">precision</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">context_quality</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">excellent</span><span class="sh">"</span>
        <span class="p">},</span>
        <span class="sh">"</span><span class="s">ë†’ì€_ì •ë°€ë„_ë‚˜ìœ_ê²½ìš°</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ê²€ìƒ‰ëœ ë¬¸ì„œ ìˆ˜ê°€ ë„ˆë¬´ ì ìŒ</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">precision</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">context_quality</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">insufficient</span><span class="sh">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">scenarios</span>
</code></pre></div></div>

<p><strong>ì‹¤ì œ ê²½í—˜:</strong></p>
<ul>
  <li>Context Precision 0.8+ : ìš°ìˆ˜</li>
  <li>Context Recall 0.7+ : ì–‘í˜¸</li>
  <li>Answer Relevancy 0.8+ : ìš°ìˆ˜</li>
  <li>Faithfulness 0.9+ : í•„ìˆ˜ (hallucination ë°©ì§€)</li>
</ul>

<h3 id="2-ë©”íŠ¸ë¦­-ê°„-íŠ¸ë ˆì´ë“œì˜¤í”„-ê´€ê³„">2. ë©”íŠ¸ë¦­ ê°„ íŠ¸ë ˆì´ë“œì˜¤í”„ ê´€ê³„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tradeoffs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ì •ë°€ë„_vs_ì¬í˜„ìœ¨</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">high_precision</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ê´€ë ¨ ë¬¸ì„œë§Œ ê²€ìƒ‰, ì •ë³´ ë¶€ì¡± ìœ„í—˜</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">high_recall</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ëª¨ë“  ê´€ë ¨ ì •ë³´ í¬í•¨, ë…¸ì´ì¦ˆ ì¦ê°€</span><span class="sh">"</span>
    <span class="p">},</span>
    <span class="sh">"</span><span class="s">ì¶©ì‹¤ì„±_vs_ê´€ë ¨ì„±</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">high_faithfulness</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ê²€ìƒ‰ ë¬¸ì„œì—ë§Œ ì˜ì¡´, ì°½ì˜ì  ë‹µë³€ ì œí•œ</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">high_relevancy</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì§ˆë¬¸ì— ìµœì í™”, ì‚¬ì‹¤ ì™œê³¡ ìœ„í—˜</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-ë„ë©”ì¸ë³„-í‰ê°€-ê¸°ì¤€-ì°¨ì´">3. ë„ë©”ì¸ë³„ í‰ê°€ ê¸°ì¤€ ì°¨ì´</h3>

<p><strong>ì˜ë£Œ/ë²•ë¥  ë„ë©”ì¸:</strong></p>
<ul>
  <li>Faithfulness &gt; 0.95 (ì‚¬ì‹¤ ì •í™•ì„± ì¤‘ìš”)</li>
  <li>Context Precision &gt; 0.9 (ì „ë¬¸ì„± ìš”êµ¬)</li>
</ul>

<p><strong>ì°½ì‘/ë§ˆì¼€íŒ… ë„ë©”ì¸:</strong></p>
<ul>
  <li>Answer Relevancy &gt; 0.85 (ì‚¬ìš©ì ë§Œì¡±ë„ ì¤‘ìš”)</li>
  <li>Faithfulness &gt; 0.7 (ì°½ì˜ì„± í—ˆìš©)</li>
</ul>

<h3 id="4-í‰ê°€-ìë™í™”ì˜-ì‹¤ì œ-êµ¬í˜„">4. í‰ê°€ ìë™í™”ì˜ ì‹¤ì œ êµ¬í˜„</h3>

<p><strong>A/B í…ŒìŠ¤íŠ¸ í†µí•©:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RAGABTestEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">variant_a</span><span class="p">,</span> <span class="n">variant_b</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">variant_a</span> <span class="o">=</span> <span class="n">variant_a</span>
        <span class="n">self</span><span class="p">.</span><span class="n">variant_b</span> <span class="o">=</span> <span class="n">variant_b</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">def</span> <span class="nf">run_split_test</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">questions</span><span class="p">,</span> <span class="n">split_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">random</span>
        
        <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">:</span>
            <span class="n">variant</span> <span class="o">=</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span> <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">split_ratio</span> <span class="k">else</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">variant_a</span> <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">variant_b</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">chain</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span><span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
                <span class="c1"># ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ (ì‹¤ì œ í™˜ê²½ì—ì„œ)
</span>                <span class="n">feedback_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_collect_user_feedback</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="n">variant</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">feedback_score</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error in variant </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">analyze_results</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
        
        <span class="n">scores_a</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">scores_b</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># í†µê³„ì  ìœ ì˜ì„± ê²€ì •
</span>        <span class="n">t_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="nf">ttest_ind</span><span class="p">(</span><span class="n">scores_a</span><span class="p">,</span> <span class="n">scores_b</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">variant_a_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores_a</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">variant_b_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores_b</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">p_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">significant</span><span class="sh">'</span><span class="p">:</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
        <span class="p">}</span>
</code></pre></div></div>

<h3 id="5-ì‹¤ì „-í‰ê°€-ì‹œìŠ¤í…œ-êµ¬ì¶•-ê²½í—˜">5. ì‹¤ì „ í‰ê°€ ì‹œìŠ¤í…œ êµ¬ì¶• ê²½í—˜</h3>

<p><strong>ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">streamlit</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">import</span> <span class="n">plotly.express</span> <span class="k">as</span> <span class="n">px</span>

<span class="k">def</span> <span class="nf">create_rag_dashboard</span><span class="p">(</span><span class="n">evaluation_results</span><span class="p">):</span>
    <span class="n">st</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">RAG System Performance Dashboard</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ë©”íŠ¸ë¦­ íŠ¸ë Œë“œ
</span>    <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">evaluation_results</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">],</span> 
                  <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">Performance Trends Over Time</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">st</span><span class="p">.</span><span class="nf">plotly_chart</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1"># ì„±ëŠ¥ ë¶„í¬
</span>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="nf">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">metric</span><span class="p">(</span><span class="sh">"</span><span class="s">Average Faithfulness</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">metrics_df</span><span class="p">[</span><span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">metric</span><span class="p">(</span><span class="sh">"</span><span class="s">Average Answer Relevancy</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">metrics_df</span><span class="p">[</span><span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì‹¤ì‹œê°„ ì„±ëŠ¥ ì•Œë¦¼:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup_performance_alerts</span><span class="p">():</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">context_precision</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.7</span>
    <span class="p">}</span>
    
    <span class="c1"># Slack, ì´ë©”ì¼ ë“±ìœ¼ë¡œ ì•Œë¦¼
</span>    <span class="k">def</span> <span class="nf">alert_performance_drop</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">current_score</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">âš ï¸ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s"> dropped to </span><span class="si">{</span><span class="n">current_score</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
        <span class="nf">send_slack_notification</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></div>

<p>ì´ëŸ¬í•œ í¬ê´„ì ì¸ í‰ê°€ ì‹œìŠ¤í…œì„ í†µí•´ RAG ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í’ˆì§ˆì„ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ê°œì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/ml-ai/RAG/">
                <span class="nav-label">ì´ì „ ê¸€</span>
                <span class="nav-title">RAG (Retrieval-Augmented Ge...</span>
            </a>
            
            
            
            <a class="next-post" href="/ml-ai/RAG-advance/">
                <span class="nav-label">ë‹¤ìŒ ê¸€</span>
                <span class="nav-title">RAG ê³ ê¸‰ ê¸°ë²• ì™„ì „ ì •ë³µ</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>