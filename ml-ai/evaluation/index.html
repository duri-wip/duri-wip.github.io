<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG ВІюВіцьЁю ьЈЅЖ░ђьЋўЖИ░</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- ВѓгВЮ┤вЊюв░ћ -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>╦Ќ╦Ј╦І РІє№йА­ќд╣ ╦џ ­ЊЄ╝ ╦џ№йАРІє РЮђ╦ќ┬░</p>
        <p>ВўЏвѓаВЌљ 
 вЇ░ВЮ┤ьё░ ВЌћВДђвІѕВќ┤Ж░ђ ВъѕВЌЄВіе.. в░▒ВЌћвЊю Вёюв▓ёвЈё вДївЊцЖ│а ВЮИьћёвЮ╝вЈё ЖхгВХЋьЋўЖ│а вЇ░ВЮ┤ьё░ вХёВёЮвЈё ьќѕВіе.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    РађРађРађРађРађРађРбђРАцРБцРБђРађРађРађРађРађРађРађРађРађРађРБђРАђРађРађРађРађРађРађ
    РађРађРађРађРађРбђРАЈРађРађРаѕРа│РБёРађРађРађРађРађРБђРа┤РаІРаЅРаЅРАєРађРађРађРађРађ
    РађРађРађРађРађРбИРађРађРађРађРађРаѕРаЅРаЅРаЎРаЊРаџРаЂРађРађРађРађРБ┐РађРађРађРађРађ
    РађРађРађРађРбђРаъРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРа╣РБёРађРађРађРађ
    РађРађРађРађРАъРађРађРађРађРађРаХРађРађРађРађРађРађРадРађРађРађРађРађРаИРАєРађРађРађ
    РбаРБцРБХРБЙРБДРБцРБцРБђРАђРађРађРађРађРаѕРађРађРађРбђРАцРа┤РаХРацРбцРАђРБДРБђРБђРађ
    Ра╗РаХРБЙРаЂРађРађРађРађРаЎРБєРађРађРађРађРађРађРБ░РаІРађРађРађРађРађРб╣РБ┐РБГРБйРаЄ
    РађРађРаЎРацРа┤РбцРАцРацРацРаІРаЅРаЅРаЅРаЅРаЅРаЅРаЅРа│РаќРадРацРаХРадРаъРаЂРађРађРађ
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- вЕћВЮИ ВйўьЁљВИа -->
        <main class="main-content">
            <!-- ьЌцвЇћ -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- ВйўьЁљВИа ВўЂВЌГ -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">RAG ВІюВіцьЁю ьЈЅЖ░ђьЋўЖИ░</h1>
        <div class="post-meta">
            <time class="post-date">2025вЁё 07ВЏћ 31ВЮ╝</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">ML-AI</span>
                    
                
                    
                
                
                <span class="subcategory-tag">rag</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#genai-llm</span>
                
                <span class="tag">#langchain</span>
                
                <span class="tag">#rag</span>
                
                <span class="tag">#vector-store</span>
                
                <span class="tag">#embedding</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="rag-ВІюВіцьЁю-ьЈЅЖ░ђ">RAG ВІюВіцьЁю ьЈЅЖ░ђ</h1>

<p>RAG ВІюВіцьЁюВЮў ьЈЅЖ░ђвіћ <strong>ВўцьћёвЮ╝ВЮИ ьЈЅЖ░ђ</strong>ВЎђ <strong>ВўевЮ╝ВЮИ ьЈЅЖ░ђ</strong>Ж░ђ ВъѕВіхвІѕвІц. ВўевЮ╝ВЮИ ьЈЅЖ░ђвіћ ВѓгВџЕВъљ ьћ╝вЊюв░▒ВЌљ ВЮўьЋю ьћ╝вЊюв░▒ вБеьћёвЦ╝ ьЃђвіћ вѓ┤ВџЕВЮ┤в»ђвАю ВўцьћёвЮ╝ВЮИ ьЈЅЖ░ђВЌљ вїђьЋ┤ВёювДї вІцвБ╣вІѕвІц.</p>

<h2 id="1-ragas-rag-assessment">1. RAGAS (RAG Assessment)</h2>

<p>RAGASвіћ RAG ВІюВіцьЁюВЮё ьЈЅЖ░ђьЋўЖИ░ ВюёьЋю ьћёваѕВъёВЏїьЂгвАю, вІцВќЉьЋю ьЈЅЖ░ђ вЕћьіИвдГВЮё ВаюЖ│хьЋЕвІѕвІц.</p>

<h3 id="Ж▓ђВЃЅ-Ж┤ђвае-вЕћьіИвдГ">Ж▓ђВЃЅ Ж┤ђвае вЕћьіИвдГ</h3>

<h4 id="1-ВйўьЁЇВіцьіИ-ВаЋв░ђвЈё-context-precision">1. ВйўьЁЇВіцьіИ ВаЋв░ђвЈё (Context Precision)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ВДѕвгИЖ│╝ ЖИ░вїђьЋўвіћ вІхв│ђВЮё Ж│авацьЋ┤ ВІцВаю Ж▓ђВЃЅ Ж▓░Ж│╝ ВцЉ ВюаВџЕьЋўвІцЖ│а LLMВЮ┤ ВХћвАаьЋўвіћ в╣ёВюе</li>
  <li><strong>ВИАВаЋ</strong>: Ж▓ђВЃЅвљю вгИВёю ВцЉ ВІцВаювАю вІхв│ђВЌљ вЈёВЏђВЮ┤ вљўвіћ вгИВёюВЮў в╣ёВюе</li>
</ul>

<h4 id="2-ВйўьЁЇВіцьіИ-ВъгьўёВюе-context-recall">2. ВйўьЁЇВіцьіИ ВъгьўёВюе (Context Recall)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ЖИ░вїђьЋўвіћ вІхв│ђВЮё ВЌгвЪг вгИВъЦВю╝вАю вѓўвѕ┤ВЮё вЋї ВІцВаю Ж▓ђВЃЅ Ж▓░Ж│╝вАю ВёцвфЁьЋа Вѕў Въѕвіћ в╣ёВюе</li>
  <li><strong>ВИАВаЋ</strong>: ВаЋвІхВЌљ ьЈгьЋевљю ВаЋв│┤ ВцЉ Ж▓ђВЃЅвљю вгИВёюВЌљВёю В░ЙВЮё Вѕў Въѕвіћ ВаЋв│┤ВЮў в╣ёВюе</li>
</ul>

<h4 id="3-ВйўьЁЇВіцьіИ-ВЌћьІ░ьІ░-ВъгьўёВюе-context-entity-recall">3. ВйўьЁЇВіцьіИ ВЌћьІ░ьІ░ ВъгьўёВюе (Context Entity Recall)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ЖИ░вїђьЋўвіћ вІхв│ђВЌљ ьЈгьЋевљю ВЌћьІ░ьІ░(Ж░юВ▓┤) ВцЉ ВІцВаю Ж▓ђВЃЅ Ж▓░Ж│╝ВЌљ ьЈгьЋевљю в╣ёВюе</li>
  <li><strong>ВИАВаЋ</strong>: ВаЋвІхВЮў ьЋхВІг ВЌћьІ░ьІ░ ВцЉ Ж▓ђВЃЅ вгИВёюВЌљВёю в░юЖ▓гвљўвіћ ВЌћьІ░ьІ░ВЮў в╣ёВюе</li>
</ul>

<h3 id="ВЃЮВё▒-Ж┤ђвае-вЕћьіИвдГ">ВЃЮВё▒ Ж┤ђвае вЕћьіИвдГ</h3>

<h4 id="1-вІхв│ђ-Ж┤ђваеВё▒-answer-relevancy">1. вІхв│ђ Ж┤ђваеВё▒ (Answer Relevancy)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ВІцВаю вІхв│ђВЮ┤ ВДѕвгИЖ│╝ Вќ╝вДѕвѓў Ж┤ђваевљўвіћВДђ ВИАВаЋ</li>
  <li><strong>Ж│ёВѓ░</strong>: ВІцВаю вІхв│ђВЌљВёю LLMВю╝вАю ВХћвАаьЋю ВДѕвгИЖ│╝ ВЏљвъў ВДѕвгИВЮў Въёв▓авћЕ в▓Аьё░ ВйћВѓгВЮИ ВюаВѓгвЈё ьЈЅЖиаЖ░њ</li>
</ul>

<h4 id="2-ВХЕВІцВё▒-faithfulness">2. ВХЕВІцВё▒ (Faithfulness)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ВІцВаю вІхв│ђВЌљ ьЈгьЋевљю ВБ╝ВъЦ ВцЉ ВІцВаю Ж▓ђВЃЅ Ж▓░Ж│╝ВЎђ ВЮ╝Ж┤ђвљю в╣ёВюе</li>
  <li><strong>ВИАВаЋ</strong>: ВЃЮВё▒вљю вІхв│ђВЮ┤ Ж▓ђВЃЅвљю вгИВёюВЮў вѓ┤ВџЕЖ│╝ Вќ╝вДѕвѓў ВЮ╝В╣ўьЋўвіћВДђ ьЈЅЖ░ђ</li>
</ul>

<h3 id="Ж▓ђВЃЅ--ВЃЮВё▒-ьєхьЋЕ-вЕћьіИвдГ">Ж▓ђВЃЅ + ВЃЮВё▒ ьєхьЋЕ вЕћьіИвдГ</h3>

<h4 id="1-вІхв│ђ-ВюаВѓгВё▒-answer-similarity">1. вІхв│ђ ВюаВѓгВё▒ (Answer Similarity)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ВІцВаю вІхв│ђЖ│╝ ЖИ░вїђьЋўвіћ вІхв│ђВЮў Въёв▓авћЕ в▓Аьё░ ВйћВѓгВЮИ ВюаВѓгвЈё</li>
  <li><strong>ВИАВаЋ</strong>: ВЃЮВё▒вљю вІхв│ђЖ│╝ ВаЋвІх ВѓгВЮ┤ВЮў ВЮўв»ИВаЂ ВюаВѓгвЈё</li>
</ul>

<h4 id="2-вІхв│ђ-ВаЋьЎЋВё▒-answer-correctness">2. вІхв│ђ ВаЋьЎЋВё▒ (Answer Correctness)</h4>
<ul>
  <li><strong>ВаЋВЮў</strong>: ВІцВаю вІхв│ђЖ│╝ ЖИ░вїђьЋўвіћ вІхв│ђВЮў ВѓгВІцВаЂ ВюаВѓгВё▒Ж│╝ ВЮўв»ИВаЂ ВюаВѓгВё▒ВЮў Ж░ђВцЉ ьЈЅЖиа</li>
  <li><strong>ВИАВаЋ</strong>: ВаЋьЎЋВё▒Ж│╝ ВЎёВаёВё▒ВЮё вфевЉљ Ж│авацьЋю ВбЁьЋЕВаЂ ьЈЅЖ░ђ ВДђьЉю</li>
</ul>

<p>ВЮ┤вЪгьЋю вЕћьіИвдГвЊцВЮё ьєхьЋ┤ RAG ВІюВіцьЁюВЮў Ж▓ђВЃЅ ьњѕВДѕЖ│╝ ВЃЮВё▒ ьњѕВДѕВЮё ВбЁьЋЕВаЂВю╝вАю ьЈЅЖ░ђьЋа Вѕў ВъѕВіхвІѕвІц.</p>

<h2 id="-ВХћЖ░ђвАю-ВЋїВЋёв│╝-вѓ┤ВџЕ">­ЪЊџ ВХћЖ░ђвАю ВЋїВЋёв│╝ вѓ┤ВџЕ</h2>

<h3 id="1-Ж│аЖИЅ-ьЈЅЖ░ђ-вЕћьіИвдГ">1. Ж│аЖИЅ ьЈЅЖ░ђ вЕћьіИвдГ</h3>

<p><strong>Custom Evaluation Metrics:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="c1"># вЈёвЕћВЮИв│ё вДъВХц ьЈЅЖ░ђ
</span><span class="k">class</span> <span class="nc">CustomRAGEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="sh">"</span><span class="s">general</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">self</span><span class="p">.</span><span class="n">evaluator_llm</span> <span class="o">=</span> <span class="nc">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">evaluate_domain_relevance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span><span class="sh">"""</span><span class="s">
        вЈёвЕћВЮИ: {domain}
        ВДѕвгИ: {question}
        вІхв│ђ: {answer}
        В╗еьЁЇВіцьіИ: {context}
        
        ВЮ┤ вІхв│ђВЮ┤ {domain} вЈёвЕћВЮИВЌљВёю Вќ╝вДѕвѓў ВаЂВаѕьЋюВДђ 1-10ВаљВю╝вАю ьЈЅЖ░ђьЋўЖ│а ВЮ┤ВюавЦ╝ ВёцвфЁьЋўВёИВџћ.
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="n">evaluation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">evaluator_llm</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">domain</span><span class="p">,</span>
            <span class="n">question</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
            <span class="n">answer</span><span class="o">=</span><span class="n">answer</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span>
        <span class="p">))</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_score</span><span class="p">(</span><span class="n">evaluation</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Retrieval Quality Metrics:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="k">class</span> <span class="nc">RetrievalQualityEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">embeddings_model</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">embeddings_model</span>
    
    <span class="k">def</span> <span class="nf">calculate_mrr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Mean Reciprocal Rank Ж│ёВѓ░</span><span class="sh">"""</span>
        <span class="n">mrr_scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">query</span><span class="p">,</span> <span class="n">retrieved</span><span class="p">,</span> <span class="n">relevant</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevant_docs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
                    <span class="n">mrr_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">rank</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mrr_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mrr_scores</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">calculate_ndcg</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">,</span> <span class="n">retrieved_docs</span><span class="p">,</span> <span class="n">relevance_scores</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Normalized Discounted Cumulative Gain Ж│ёВѓ░</span><span class="sh">"""</span>
        <span class="n">ndcg_scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">query_idx</span><span class="p">,</span> <span class="n">retrieved</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved_docs</span><span class="p">):</span>
            <span class="n">dcg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">idcg</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="c1"># ВІцВаю ВѕюВёюВЮў DCG Ж│ёВѓ░
</span>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">retrieved</span><span class="p">[:</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">relevance</span> <span class="o">=</span> <span class="n">relevance_scores</span><span class="p">[</span><span class="n">query_idx</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">dcg</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">relevance</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># ВЮ┤ВЃЂВаЂ ВѕюВёюВЮў IDCG Ж│ёВѓ░
</span>            <span class="n">ideal_relevances</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">relevance_scores</span><span class="p">[</span><span class="n">query_idx</span><span class="p">].</span><span class="nf">values</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rel</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">ideal_relevances</span><span class="p">):</span>
                <span class="n">idcg</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">rel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">log2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="n">ndcg_scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">dcg</span> <span class="o">/</span> <span class="n">idcg</span> <span class="k">if</span> <span class="n">idcg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">ndcg_scores</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-ВъљвЈЎьЎћвљю-ьЈЅЖ░ђ-ьїїВЮ┤ьћёвЮ╝ВЮИ">2. ВъљвЈЎьЎћвљю ьЈЅЖ░ђ ьїїВЮ┤ьћёвЮ╝ВЮИ</h3>

<p><strong>Continuous Evaluation:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">schedule</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">ContinuousRAGEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rag_chain</span><span class="p">,</span> <span class="n">test_dataset</span><span class="p">,</span> <span class="n">evaluators</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rag_chain</span> <span class="o">=</span> <span class="n">rag_chain</span>
        <span class="n">self</span><span class="p">.</span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span>
        <span class="n">self</span><span class="p">.</span><span class="n">evaluators</span> <span class="o">=</span> <span class="n">evaluators</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results_history</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">run_evaluation</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ВаЋЖИ░ ьЈЅЖ░ђ ВІцьќЅ</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting evaluation at </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        
        <span class="c1"># Ж░Ђ ьЈЅЖ░ђВъљв│ёвАю вЕћьіИвдГ Ж│ёВѓ░
</span>        <span class="k">for</span> <span class="n">evaluator_name</span><span class="p">,</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">evaluators</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">metric_score</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">rag_chain</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">test_dataset</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">][</span><span class="n">evaluator_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_score</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">evaluator_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">metric_score</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error in </span><span class="si">{</span><span class="n">evaluator_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">][</span><span class="n">evaluator_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_check_performance_degradation</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_check_performance_degradation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Вё▒віЦ ВађьЋў Ж░љВДђ</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">current</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results_history</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="sh">'</span><span class="s">metrics</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_score</span> <span class="ow">in</span> <span class="n">current</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_score</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">previous</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="n">degradation</span> <span class="o">=</span> <span class="n">previous</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_score</span>
            <span class="k">if</span> <span class="n">degradation</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_alert_performance_issue</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">degradation</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">schedule_evaluations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">interval_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ВаЋЖИ░ ьЈЅЖ░ђ ВіцВ╝ђВцёвДЂ</span><span class="sh">"""</span>
        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">(</span><span class="n">interval_hours</span><span class="p">).</span><span class="n">hours</span><span class="p">.</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">run_evaluation</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">schedule</span><span class="p">.</span><span class="nf">run_pending</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>  <span class="c1"># 1ВІюЖ░ёвДѕвІц В▓┤ьЂг
</span></code></pre></div></div>

<h3 id="3-в▓цВ╣ўвДѕьЂг-вЇ░ВЮ┤ьё░ВЁІ-ьЎюВџЕ">3. в▓цВ╣ўвДѕьЂг вЇ░ВЮ┤ьё░ВЁІ ьЎюВџЕ</h3>

<p><strong>Popular RAG Benchmarks:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MS MARCO вЇ░ВЮ┤ьё░ВЁІ ьЎюВџЕ
</span><span class="kn">from</span> <span class="n">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>

<span class="k">class</span> <span class="nc">BenchmarkEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">ms_marco</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_ms_marco</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">natural_questions</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_nq</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">hotpot_qa</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_hotpot</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_load_ms_marco</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="nf">load_dataset</span><span class="p">(</span><span class="sh">"</span><span class="s">ms_marco</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">v1.1</span><span class="sh">"</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="sh">"</span><span class="s">validation</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span>
            <span class="sh">'</span><span class="s">question</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">expected_answer</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">answers</span><span class="sh">'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">answers</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">''</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">context</span><span class="sh">'</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">passages</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))]</span>
    
    <span class="k">def</span> <span class="nf">evaluate_on_benchmark</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rag_chain</span><span class="p">,</span> <span class="n">benchmark_name</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">в▓цВ╣ўвДѕьЂг вЇ░ВЮ┤ьё░ВЁІВю╝вАю ьЈЅЖ░ђ</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">benchmark_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unknown benchmark: </span><span class="si">{</span><span class="n">benchmark_name</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">benchmark_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">benchmarks</span><span class="p">[</span><span class="n">benchmark_name</span><span class="p">]</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">benchmark_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">rag_chain</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span><span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">question</span><span class="sh">'</span><span class="p">]})</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_similarity</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="sh">'</span><span class="s">expected_answer</span><span class="sh">'</span><span class="p">])</span>
                <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error processing question: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">benchmark</span><span class="sh">'</span><span class="p">:</span> <span class="n">benchmark_name</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">average_score</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_questions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">benchmark_data</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">successful_answers</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scores</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="-ьЋЎВіхьЋўвЕ┤Вёю-ВЋїЖ▓ї-вљю-Ваљ">­ЪћЇ ьЋЎВіхьЋўвЕ┤Вёю ВЋїЖ▓ї вљю Ваљ</h2>

<h3 id="1-ragas-вЕћьіИвдГВЮў-ВІцВаю-ьЋ┤ВёЮ">1. RAGAS вЕћьіИвдГВЮў ВІцВаю ьЋ┤ВёЮ</h3>

<p><strong>Context PrecisionВЮў ьЋеВаЋ:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Context PrecisionВЮ┤ вєњвІцЖ│а ьЋГВЃЂ ВбІВЮђ Ж▓ЃВЮђ ВЋёвІў
</span><span class="k">def</span> <span class="nf">analyze_context_precision</span><span class="p">():</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">вєњВЮђ_ВаЋв░ђвЈё_ВбІВЮђ_Ж▓йВџ░</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ж┤ђваеВё▒ вєњВЮђ вгИВёювДї Ж▓ђВЃЅ</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">precision</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">context_quality</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">excellent</span><span class="sh">"</span>
        <span class="p">},</span>
        <span class="sh">"</span><span class="s">вєњВЮђ_ВаЋв░ђвЈё_вѓўВЂю_Ж▓йВџ░</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ж▓ђВЃЅвљю вгИВёю ВѕўЖ░ђ вёѕвг┤ ВаЂВЮї</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">precision</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">context_quality</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">insufficient</span><span class="sh">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">scenarios</span>
</code></pre></div></div>

<p><strong>ВІцВаю Ж▓йьЌў:</strong></p>
<ul>
  <li>Context Precision 0.8+ : Вџ░Вѕў</li>
  <li>Context Recall 0.7+ : ВќЉьўИ</li>
  <li>Answer Relevancy 0.8+ : Вџ░Вѕў</li>
  <li>Faithfulness 0.9+ : ьЋёВѕў (hallucination в░ЕВДђ)</li>
</ul>

<h3 id="2-вЕћьіИвдГ-Ж░ё-ьіИваѕВЮ┤вЊюВўцьћё-Ж┤ђЖ│ё">2. вЕћьіИвдГ Ж░ё ьіИваѕВЮ┤вЊюВўцьћё Ж┤ђЖ│ё</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tradeoffs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">ВаЋв░ђвЈё_vs_ВъгьўёВюе</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">high_precision</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ж┤ђвае вгИВёювДї Ж▓ђВЃЅ, ВаЋв│┤ вХђВА▒ ВюёьЌў</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">high_recall</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">вфевЊа Ж┤ђвае ВаЋв│┤ ьЈгьЋе, вЁИВЮ┤Вдѕ ВдЮЖ░ђ</span><span class="sh">"</span>
    <span class="p">},</span>
    <span class="sh">"</span><span class="s">ВХЕВІцВё▒_vs_Ж┤ђваеВё▒</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">high_faithfulness</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ж▓ђВЃЅ вгИВёюВЌљвДї ВЮўВА┤, В░йВЮўВаЂ вІхв│ђ ВаюьЋю</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">high_relevancy</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ВДѕвгИВЌљ ВхюВаЂьЎћ, ВѓгВІц ВЎюЖ│А ВюёьЌў</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-вЈёвЕћВЮИв│ё-ьЈЅЖ░ђ-ЖИ░Вцђ-В░еВЮ┤">3. вЈёвЕћВЮИв│ё ьЈЅЖ░ђ ЖИ░Вцђ В░еВЮ┤</h3>

<p><strong>ВЮўвБї/в▓ЋвЦа вЈёвЕћВЮИ:</strong></p>
<ul>
  <li>Faithfulness &gt; 0.95 (ВѓгВІц ВаЋьЎЋВё▒ ВцЉВџћ)</li>
  <li>Context Precision &gt; 0.9 (ВаёвгИВё▒ ВџћЖхг)</li>
</ul>

<p><strong>В░йВъЉ/вДѕВ╝ђьїЁ вЈёвЕћВЮИ:</strong></p>
<ul>
  <li>Answer Relevancy &gt; 0.85 (ВѓгВџЕВъљ вДїВА▒вЈё ВцЉВџћ)</li>
  <li>Faithfulness &gt; 0.7 (В░йВЮўВё▒ ьЌѕВџЕ)</li>
</ul>

<h3 id="4-ьЈЅЖ░ђ-ВъљвЈЎьЎћВЮў-ВІцВаю-Жхгьўё">4. ьЈЅЖ░ђ ВъљвЈЎьЎћВЮў ВІцВаю Жхгьўё</h3>

<p><strong>A/B ьЁїВіцьіИ ьєхьЋЕ:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RAGABTestEvaluator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">variant_a</span><span class="p">,</span> <span class="n">variant_b</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">variant_a</span> <span class="o">=</span> <span class="n">variant_a</span>
        <span class="n">self</span><span class="p">.</span><span class="n">variant_b</span> <span class="o">=</span> <span class="n">variant_b</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]}</span>
    
    <span class="k">def</span> <span class="nf">run_split_test</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">questions</span><span class="p">,</span> <span class="n">split_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="kn">import</span> <span class="n">random</span>
        
        <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">questions</span><span class="p">:</span>
            <span class="n">variant</span> <span class="o">=</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span> <span class="k">if</span> <span class="n">random</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">split_ratio</span> <span class="k">else</span> <span class="sh">'</span><span class="s">b</span><span class="sh">'</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">variant_a</span> <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">variant_b</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="n">chain</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span><span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
                <span class="c1"># ВѓгВџЕВъљ ьћ╝вЊюв░▒ ВѕўВДЉ (ВІцВаю ьЎўЖ▓йВЌљВёю)
</span>                <span class="n">feedback_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_collect_user_feedback</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="n">variant</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">feedback_score</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error in variant </span><span class="si">{</span><span class="n">variant</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">analyze_results</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
        
        <span class="n">scores_a</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">scores_b</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">b</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># ьєхЖ│ёВаЂ ВюаВЮўВё▒ Ж▓ђВаЋ
</span>        <span class="n">t_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="p">.</span><span class="nf">ttest_ind</span><span class="p">(</span><span class="n">scores_a</span><span class="p">,</span> <span class="n">scores_b</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">variant_a_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores_a</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">variant_b_mean</span><span class="sh">'</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">scores_b</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">p_value</span><span class="sh">'</span><span class="p">:</span> <span class="n">p_value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">significant</span><span class="sh">'</span><span class="p">:</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span>
        <span class="p">}</span>
</code></pre></div></div>

<h3 id="5-ВІцВаё-ьЈЅЖ░ђ-ВІюВіцьЁю-ЖхгВХЋ-Ж▓йьЌў">5. ВІцВаё ьЈЅЖ░ђ ВІюВіцьЁю ЖхгВХЋ Ж▓йьЌў</h3>

<p><strong>вфевІѕьё░вДЂ вїђВІюв│┤вЊю:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">streamlit</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">import</span> <span class="n">plotly.express</span> <span class="k">as</span> <span class="n">px</span>

<span class="k">def</span> <span class="nf">create_rag_dashboard</span><span class="p">(</span><span class="n">evaluation_results</span><span class="p">):</span>
    <span class="n">st</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">RAG System Performance Dashboard</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># вЕћьіИвдГ ьіИваївЊю
</span>    <span class="n">metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">evaluation_results</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">],</span> 
                  <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">Performance Trends Over Time</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">st</span><span class="p">.</span><span class="nf">plotly_chart</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="c1"># Вё▒віЦ вХёьЈг
</span>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="nf">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">metric</span><span class="p">(</span><span class="sh">"</span><span class="s">Average Faithfulness</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">metrics_df</span><span class="p">[</span><span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
        <span class="n">st</span><span class="p">.</span><span class="nf">metric</span><span class="p">(</span><span class="sh">"</span><span class="s">Average Answer Relevancy</span><span class="sh">"</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">metrics_df</span><span class="p">[</span><span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">].</span><span class="nf">mean</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ВІцВІюЖ░ё Вё▒віЦ ВЋївд╝:</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup_performance_alerts</span><span class="p">():</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">faithfulness</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">answer_relevancy</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">context_precision</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.7</span>
    <span class="p">}</span>
    
    <span class="c1"># Slack, ВЮ┤вЕћВЮ╝ вЊ▒Вю╝вАю ВЋївд╝
</span>    <span class="k">def</span> <span class="nf">alert_performance_drop</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">current_score</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Рџа№ИЈ </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s"> dropped to </span><span class="si">{</span><span class="n">current_score</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
        <span class="nf">send_slack_notification</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></div>

<p>ВЮ┤вЪгьЋю ьЈгЖ┤ёВаЂВЮИ ьЈЅЖ░ђ ВІюВіцьЁюВЮё ьєхьЋ┤ RAG ВЋаьћївдгВ╝ђВЮ┤ВЁўВЮў ьњѕВДѕВЮё ВДђВєЇВаЂВю╝вАю вфевІѕьё░вДЂьЋўЖ│а Ж░юВёаьЋа Вѕў ВъѕВіхвІѕвІц.</p>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/ml-ai/RAG/">
                <span class="nav-label">ВЮ┤Ваё ЖИђ</span>
                <span class="nav-title">RAG (Retrieval-Augmented Ge...</span>
            </a>
            
            
            
            <a class="next-post" href="/ml-ai/RAG-advance/">
                <span class="nav-label">вІцВЮї ЖИђ</span>
                <span class="nav-title">RAG Ж│аЖИЅ ЖИ░в▓Ћ ВЎёВаё ВаЋв│х</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">Рєљ ьЎѕВю╝вАю вЈїВЋёЖ░ђЖИ░</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>