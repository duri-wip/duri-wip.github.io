<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG (Retrieval-Augmented Generation) ì™„ì „ ì •ë³µ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="stylesheet" href="/assets/css/study.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link rel="stylesheet" href="/assets/css/header.css">
    <link rel="stylesheet" href="/assets/css/banner.css">
    <link rel="stylesheet" href="/assets/css/sections.css">
    <link rel="stylesheet" href="/assets/css/post.css">
    <link rel="stylesheet" href="/assets/css/categories.css">
    <link rel="stylesheet" href="/assets/css/projects.css">
</head>
<body>
    <div class="container">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
    <img src="/assets/images/avatar.png" alt="Duri" class="profile-image">
    <div class="profile-info">
        <h2>Duri</h2>
        <p>Ë—ËË‹ â‹†ï½¡ğ–¦¹ Ëš ğ“‡¼ Ëšï½¡â‹† â€Ë–Â°</p>
        <p>ì˜›ë‚ ì— 
 ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ìˆì—‡ìŠ¨.. ë°±ì—”ë“œ ì„œë²„ë„ ë§Œë“¤ê³  ì¸í”„ë¼ë„ êµ¬ì¶•í•˜ê³  ë°ì´í„° ë¶„ì„ë„ í–ˆìŠ¨.. </p>
    </div>
    
    <div class="contact-links">
        <div class="profile-divider">
    â €â €â €â €â €â €â¢€â¡¤â£¤â£€â €â €â €â €â €â €â €â €â €â €â£€â¡€â €â €â €â €â €â €
    â €â €â €â €â €â¢€â¡â €â €â ˆâ ³â£„â €â €â €â €â €â£€â ´â ‹â ‰â ‰â¡†â €â €â €â €â €
    â €â €â €â €â €â¢¸â €â €â €â €â €â ˆâ ‰â ‰â ™â “â šâ â €â €â €â €â£¿â €â €â €â €â €
    â €â €â €â €â¢€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¹â£„â €â €â €â €
    â €â €â €â €â¡â €â €â €â €â €â ¶â €â €â €â €â €â €â ¦â €â €â €â €â €â ¸â¡†â €â €â €
    â¢ â£¤â£¶â£¾â£§â£¤â£¤â£€â¡€â €â €â €â €â ˆâ €â €â €â¢€â¡¤â ´â ¶â ¤â¢¤â¡€â£§â£€â£€â €
    â »â ¶â£¾â â €â €â €â €â ™â£†â €â €â €â €â €â €â£°â ‹â €â €â €â €â €â¢¹â£¿â£­â£½â ‡
    â €â €â ™â ¤â ´â¢¤â¡¤â ¤â ¤â ‹â ‰â ‰â ‰â ‰â ‰â ‰â ‰â ³â –â ¦â ¤â ¶â ¦â â â €â €â €
        </div>
        
        <a href="https://github.com/duri-wip" class="contact-link" target="_blank">
            <i class="fab fa-github"></i>
            <span>GitHub</span>
        </a>
        
        
        <a href="mailto:8s.eow.ooc@gmail.com" class="contact-link">
            <i class="fas fa-envelope"></i>
            <span>Email</span>
        </a>
        
    </div>
    
</aside>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- í—¤ë” -->
            <header class="header">
    <nav>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="/">home</a>
            </li>
            <li class="nav-item">
                <a href="/categories">category</a>
            </li>
            <li class="nav-item">
                <a href="/study">study</a>
            </li>
            <li class="nav-item">
                <a href="/projects">project</a>
            </li>
        </ul>
    </nav>
</header>
            
            <!-- ì½˜í…ì¸  ì˜ì—­ -->
            <div class="content">
                <article class="post">
    <header class="post-header">
        <h1 class="post-title">RAG (Retrieval-Augmented Generation) ì™„ì „ ì •ë³µ</h1>
        <div class="post-meta">
            <time class="post-date">2025ë…„ 07ì›” 31ì¼</time>
            
            <div class="post-categories">
                
                    
                    <span class="category-tag">ML-AI</span>
                    
                
                    
                
                
                <span class="subcategory-tag">rag</span>
                
            </div>
            
            
            <div class="post-tags">
                
                <span class="tag">#genai-llm</span>
                
                <span class="tag">#langchain</span>
                
                <span class="tag">#rag</span>
                
                <span class="tag">#vector-store</span>
                
                <span class="tag">#embedding</span>
                
                <span class="tag">#study-llm-framework</span>
                
            </div>
            
        </div>
    </header>

    <div class="post-content">
        <h1 id="langchainì—ì„œ-rag-ì‚¬ìš©í•˜ê¸°">LangChainì—ì„œ RAG ì‚¬ìš©í•˜ê¸°</h1>

<h2 id="ê´€ë ¨-ì»´í¬ë„ŒíŠ¸">ê´€ë ¨ ì»´í¬ë„ŒíŠ¸</h2>

<ul>
  <li><strong>Document Loader</strong>: ë°ì´í„° ì†ŒìŠ¤ì—ì„œ ë¬¸ì„œë¥¼ ì½ì–´ë“¤ì„</li>
  <li><strong>Document Transformer</strong>: ë¬¸ì„œì— ì–´ë–¤ ë³€í™˜ì„ ê°€í•¨</li>
  <li><strong>Embedding Model</strong>: ë¬¸ì„œë¥¼ ë²¡í„°í™”í•¨</li>
  <li><strong>Vector Store</strong>: ë²¡í„°í™”í•œ ë¬¸ì„œì˜ ì €ì¥ì†Œ</li>
  <li><strong>Retriever</strong>: ì…ë ¥ í…ìŠ¤íŠ¸ì™€ ê´€ë ¨ëœ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•¨</li>
</ul>

<h3 id="1-í•„ìš”í•œ-íŒŒì¼-ì½ì–´ì˜¤ê¸°">1. í•„ìš”í•œ íŒŒì¼ ì½ì–´ì˜¤ê¸°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">!</span>pip <span class="nb">install </span>langchain-community<span class="o">==</span>0.3.0 <span class="nv">GitPython</span><span class="o">==</span>3.1.43
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">GitLoader</span>

<span class="k">def</span> <span class="nf">file_filter</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">file_path</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">"</span><span class="s">.mdx</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># langchain ë¬¸ì„œëŠ” md, mdx, ipynb ë“±ì˜ í˜•ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì–´ ìˆê³ , ë¬¸ì„œì˜ ë¹Œë“œ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ì´ í˜•ì‹ì˜ ë¬¸ì„œë§Œ ì½ì–´ì•¼ í•œë‹¤
</span>
<span class="n">loader</span> <span class="o">=</span> <span class="nc">GitLoader</span><span class="p">(</span>
    <span class="n">clone_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://github.com/langchain-ai/langchain</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">repo_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">./langchain</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">branch</span> <span class="o">=</span> <span class="sh">"</span><span class="s">master</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">file_filter</span> <span class="o">=</span> <span class="n">file_filter</span>
<span class="p">)</span>

<span class="n">raw_docs</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ì—¬ëŸ¬ê°€ì§€-ë¡œë”-ì†Œê°œ">ì—¬ëŸ¬ê°€ì§€ ë¡œë” ì†Œê°œ</h2>

<ul>
  <li><strong>íŒŒì¼ ì‹œìŠ¤í…œ ë¡œë”</strong>: CSV, JSON, PDF, Text, Directory, MS Office â€¦</li>
  <li><strong>ì›¹ ê¸°ë°˜ ë¡œë”</strong>: ì›¹ í˜ì´ì§€, ì—¬ëŸ¬ ì›¹ í˜ì´ì§€ì— ëŒ€í•œ ì¬ê·€ì  ë¡œë“œ, ì‚¬ì´íŠ¸ë§µ ê¸°ë°˜ ì›¹ í˜ì´ì§€ ë¡œë“œ, ìœ íŠœë¸Œ ë¹„ë””ì˜¤ íŠ¸ëœìŠ¤í¬ë¦½íŠ¸ â€¦</li>
  <li><strong>í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€</strong></li>
  <li><strong>ë°ì´í„°ë² ì´ìŠ¤</strong></li>
  <li><strong>í˜‘ì—… ë„êµ¬, ì†Œì…œ ë¯¸ë””ì–´, ì˜¤ë””ì˜¤</strong> â€¦</li>
</ul>

<p>ëŒ€ë¶€ë¶„ì˜ ë¡œë”ëŠ” ë¬¸ì„œì™€ í•¨ê»˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<h3 id="2-ë¬¸ì„œë¥¼-ë³€í™˜í•˜ê¸°">2. ë¬¸ì„œë¥¼ ë³€í™˜í•˜ê¸°</h3>

<p><strong>Data Transformer</strong>: ë¬¸ì„œë¥¼ ì²­í‚¹í•˜ê¸°</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">!</span>pip <span class="nb">install </span>langchain-text-splitters<span class="o">==</span>0.3.0
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_text_splitters</span> <span class="kn">import</span> <span class="n">CharacterTextSplitter</span>

<span class="n">text_splitter</span> <span class="o">=</span> <span class="nc">CharacterTextSplitter</span><span class="p">(</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">chunk_overlap</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>

<span class="n">docs</span> <span class="o">=</span> <span class="n">text_splitter</span><span class="p">.</span><span class="nf">split_documents</span><span class="p">(</span><span class="n">raw_docs</span><span class="p">)</span>
</code></pre></div></div>

<p>ë‹¨ìˆœ ì²­í‚¹ ì´ì™¸ì—ë„ ë‹¤ì–‘í•œ ë³€í™˜ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤:</p>

<ul>
  <li>HTMLì„ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜</li>
  <li>ë©”íƒ€ë°ì´í„° ì¶”ì¶œ</li>
  <li>ë¬¸ì„œ ë²ˆì—­</li>
  <li>ì‚¬ìš©ì ì§ˆë¬¸ê³¼ì˜ ê´€ë ¨ì„±ì„ ë†’ì´ê¸° ìœ„í•´ ë¬¸ì„œì—ì„œ Q&amp;A ìƒì„±</li>
</ul>

<h3 id="3-ì„ë² ë”©í•˜ê¸°">3. ì„ë² ë”©í•˜ê¸°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>

<span class="n">embeddings</span> <span class="o">=</span> <span class="nc">OpenAIEmbeddings</span><span class="p">(</span>
    <span class="n">model</span> <span class="o">=</span> <span class="sh">"</span><span class="s">text-embedding-3-small</span><span class="sh">"</span>
<span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">What is LangChain?</span><span class="sh">"</span>

<span class="n">vector</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">.</span><span class="nf">embed_query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-vector-store-êµ¬ì¶•">4. Vector Store êµ¬ì¶•</h3>

<p>ì—¬ê¸°ì„œëŠ” Chromaë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># pip install langchain-chroma==0.1.4
</span>
<span class="kn">from</span> <span class="n">langchain_chroma</span> <span class="kn">import</span> <span class="n">Chroma</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span>
    <span class="n">docs</span><span class="p">,</span>
    <span class="n">embeddings</span>
<span class="p">)</span>

<span class="n">retreiver</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">as_retriever</span><span class="p">()</span>

<span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">What is LangChain?</span><span class="sh">"</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">retreiver</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">first_doc</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nf">print</span><span class="p">(</span><span class="n">first_doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">first_doc</span><span class="p">.</span><span class="n">page_content</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="lcel-í™œìš©í•˜ê¸°">LCEL í™œìš©í•˜ê¸°</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LCELì„ í™œìš©í•œ RAG chain êµ¬í˜„
</span>
<span class="kn">from</span> <span class="n">langchain_core.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="nf">from_template</span><span class="p">(</span>
    <span class="sh">'''</span><span class="s">
    Answer the question based on the context provided.
    Context: {context}
    Question: {question}
    </span><span class="sh">'''</span>
<span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="nc">ChatOpenAI</span><span class="p">(</span>
    <span class="n">model</span> <span class="o">=</span> <span class="sh">"</span><span class="s">gpt-4o-mini</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="n">langchain_core.output_parsers</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>
<span class="kn">from</span> <span class="n">langchain_core.runnables</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>

<span class="n">chain</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">context</span><span class="sh">"</span><span class="p">:</span> <span class="n">retriever</span><span class="p">,</span> <span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="nc">RunnablePassthrough</span><span class="p">()}</span>
    <span class="o">|</span> <span class="n">prompt</span>
    <span class="o">|</span> <span class="n">model</span>
    <span class="o">|</span> <span class="nc">StrOutputParser</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">chain</span><span class="p">.</span><span class="nf">invoke</span><span class="p">({</span><span class="sh">"</span><span class="s">question</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">What is LangChain?</span><span class="sh">"</span><span class="p">})</span>
</code></pre></div></div>

<h2 id="-ì¶”ê°€ë¡œ-ì•Œì•„ë³¼-ë‚´ìš©">ğŸ“š ì¶”ê°€ë¡œ ì•Œì•„ë³¼ ë‚´ìš©</h2>

<h3 id="1-ê³ ê¸‰-document-loaders">1. ê³ ê¸‰ Document Loaders</h3>

<p><strong>AsyncWebCrawler:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">AsyncWebCrawler</span>
<span class="kn">import</span> <span class="n">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">crawl_websites</span><span class="p">():</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="nc">AsyncWebCrawler</span><span class="p">(</span><span class="n">urls</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">https://example1.com</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">https://example2.com</span><span class="sh">"</span><span class="p">])</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">loader</span><span class="p">.</span><span class="nf">aload</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">docs</span>

<span class="c1"># ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì†ë„ í–¥ìƒ
</span></code></pre></div></div>

<p><strong>UnstructuredFileLoader (ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹):</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">UnstructuredFileLoader</span>

<span class="c1"># PDF, DOCX, PPTX, HTML, TXT ë“± ìë™ ì²˜ë¦¬
</span><span class="n">loader</span> <span class="o">=</span> <span class="nc">UnstructuredFileLoader</span><span class="p">(</span><span class="sh">"</span><span class="s">mixed_documents/</span><span class="sh">"</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>DatabaseLoader:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">SQLDatabaseLoader</span>

<span class="n">loader</span> <span class="o">=</span> <span class="nc">SQLDatabaseLoader</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">postgresql://user:pass@localhost/db</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">SELECT content, metadata FROM documents WHERE active = true</span><span class="sh">"</span>
<span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="nf">load</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="2-ì •êµí•œ-í…ìŠ¤íŠ¸-ë¶„í• -ì „ëµ">2. ì •êµí•œ í…ìŠ¤íŠ¸ ë¶„í•  ì „ëµ</h3>

<p><strong>RecursiveCharacterTextSplitter (ê¶Œì¥):</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_text_splitters</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>

<span class="n">text_splitter</span> <span class="o">=</span> <span class="nc">RecursiveCharacterTextSplitter</span><span class="p">(</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>  <span class="c1"># ê²¹ì¹¨ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ë³´ì¡´
</span>    <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">]</span>  <span class="c1"># ìš°ì„ ìˆœìœ„ë³„ êµ¬ë¶„ì
</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>TokenTextSplitter (í† í° ê¸°ë°˜):</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_text_splitters</span> <span class="kn">import</span> <span class="n">TokenTextSplitter</span>

<span class="c1"># ì •í™•í•œ í† í° ìˆ˜ ê¸°ë°˜ ë¶„í• 
</span><span class="n">splitter</span> <span class="o">=</span> <span class="nc">TokenTextSplitter</span><span class="p">(</span>
    <span class="n">encoding_name</span><span class="o">=</span><span class="sh">"</span><span class="s">gpt2</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># ë˜ëŠ” "cl100k_base" for GPT-4
</span>    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>SemanticChunker (ì˜ë¯¸ ê¸°ë°˜ ë¶„í• ):</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain_experimental.text_splitter</span> <span class="kn">import</span> <span class="n">SemanticChunker</span>
<span class="kn">from</span> <span class="n">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>

<span class="n">semantic_chunker</span> <span class="o">=</span> <span class="nc">SemanticChunker</span><span class="p">(</span>
    <span class="nc">OpenAIEmbeddings</span><span class="p">(),</span>
    <span class="n">breakpoint_threshold_type</span><span class="o">=</span><span class="sh">"</span><span class="s">percentile</span><span class="sh">"</span>  <span class="c1"># ì˜ë¯¸ ë³€í™” ì§€ì ì—ì„œ ë¶„í• 
</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ë²¡í„°-ìŠ¤í† ì–´-ìµœì í™”">3. ë²¡í„° ìŠ¤í† ì–´ ìµœì í™”</h3>

<p><strong>ë©”íƒ€ë°ì´í„° í•„í„°ë§:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë¬¸ì„œ ì €ì¥ ì‹œ ë©”íƒ€ë°ì´í„° ì¶”ê°€
</span><span class="n">docs_with_metadata</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nc">Document</span><span class="p">(</span>
        <span class="n">page_content</span><span class="o">=</span><span class="sh">"</span><span class="s">ë‚´ìš©</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">source</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">document1.pdf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">page</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">technical</span><span class="sh">"</span><span class="p">}</span>
    <span class="p">)</span>
<span class="p">]</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span><span class="n">docs_with_metadata</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># í•„í„° ê²€ìƒ‰
</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">as_retriever</span><span class="p">(</span>
    <span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">filter</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">technical</span><span class="sh">"</span><span class="p">}}</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì„¤ì •:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìœ ì‚¬ë„ + í‚¤ì›Œë“œ ê²€ìƒ‰ ì¡°í•©
</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">as_retriever</span><span class="p">(</span>
    <span class="n">search_type</span><span class="o">=</span><span class="sh">"</span><span class="s">mmr</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Maximal Marginal Relevance
</span>    <span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">k</span><span class="sh">"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">lambda_mult</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.7</span>  <span class="c1"># ë‹¤ì–‘ì„±ê³¼ ê´€ë ¨ì„± ê· í˜• ì¡°ì ˆ
</span>    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="4-ì„±ëŠ¥-ìµœì í™”-ì „ëµ">4. ì„±ëŠ¥ ìµœì í™” ì „ëµ</h3>

<p><strong>ë°°ì¹˜ ì„ë² ë”©:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í•œ ë²ˆì— ì—¬ëŸ¬ ë¬¸ì„œ ì„ë² ë”© (íš¨ìœ¨ì )
</span><span class="n">embeddings</span> <span class="o">=</span> <span class="nc">OpenAIEmbeddings</span><span class="p">()</span>
<span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">.</span><span class="n">page_content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">]</span>
<span class="n">vectors</span> <span class="o">=</span> <span class="n">embeddings</span><span class="p">.</span><span class="nf">embed_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>  <span class="c1"># ë°°ì¹˜ ì²˜ë¦¬
</span></code></pre></div></div>

<p><strong>ì¸ë±ìŠ¤ ìµœì í™”:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># FAISS ì‚¬ìš© (ëŒ€ìš©ëŸ‰ ë°ì´í„°ì— ì í•©)
</span><span class="kn">from</span> <span class="n">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">FAISS</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">FAISS</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
<span class="n">db</span><span class="p">.</span><span class="nf">save_local</span><span class="p">(</span><span class="sh">"</span><span class="s">faiss_index</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ì¸ë±ìŠ¤ ì €ì¥
</span>
<span class="c1"># ë¡œë“œ ì‹œ ë¹ ë¥¸ ì‹œì‘
</span><span class="n">db</span> <span class="o">=</span> <span class="n">FAISS</span><span class="p">.</span><span class="nf">load_local</span><span class="p">(</span><span class="sh">"</span><span class="s">faiss_index</span><span class="sh">"</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-í•™ìŠµí•˜ë©´ì„œ-ì•Œê²Œ-ëœ-ì ">ğŸ” í•™ìŠµí•˜ë©´ì„œ ì•Œê²Œ ëœ ì </h2>

<h3 id="1-ì²­í‚¹-ì „ëµì˜-ì‹¤ì œ-ì˜í–¥">1. ì²­í‚¹ ì „ëµì˜ ì‹¤ì œ ì˜í–¥</h3>

<p><strong>ì˜ëª»ëœ ì²­í‚¹ì˜ ë¬¸ì œ:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë„ˆë¬´ ì‘ì€ ì²­í¬ - ì»¨í…ìŠ¤íŠ¸ ë¶€ì¡±
</span><span class="n">small_splitter</span> <span class="o">=</span> <span class="nc">CharacterTextSplitter</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ë„ˆë¬´ í° ì²­í¬ - ë…¸ì´ì¦ˆ ì¦ê°€
</span><span class="n">large_splitter</span> <span class="o">=</span> <span class="nc">CharacterTextSplitter</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># ìµœì í™”ëœ ì²­í‚¹
</span><span class="n">optimal_splitter</span> <span class="o">=</span> <span class="nc">RecursiveCharacterTextSplitter</span><span class="p">(</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>      <span class="c1"># ì¶©ë¶„í•œ ì»¨í…ìŠ¤íŠ¸
</span>    <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>   <span class="c1"># 20% ê²¹ì¹¨ìœ¼ë¡œ ê²½ê³„ ì •ë³´ ë³´ì¡´
</span>    <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">. </span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># ìì—°ìŠ¤ëŸ¬ìš´ êµ¬ë¶„ì 
</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì²­í‚¹ í’ˆì§ˆ í‰ê°€:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">evaluate_chunks</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
    <span class="n">avg_length</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">.</span><span class="n">page_content</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">í‰ê·  ì²­í¬ ê¸¸ì´: </span><span class="si">{</span><span class="n">avg_length</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì´ ì²­í¬ ìˆ˜: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="c1"># ë„ˆë¬´ ì§§ê±°ë‚˜ ê¸´ ì²­í¬ í™•ì¸
</span>    <span class="n">short_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">page_content</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">]</span>
    <span class="n">long_chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chunks</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">page_content</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">]</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì§§ì€ ì²­í¬ ìˆ˜: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">short_chunks</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê¸´ ì²­í¬ ìˆ˜: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">long_chunks</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-ì„ë² ë”©-ëª¨ë¸-ì„ íƒì˜-ì¤‘ìš”ì„±">2. ì„ë² ë”© ëª¨ë¸ ì„ íƒì˜ ì¤‘ìš”ì„±</h3>

<p><strong>ëª¨ë¸ë³„ íŠ¹ì„±:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># OpenAI - ë²”ìš©ì„± ì¢‹ìŒ, ë¹„ìš© ìˆìŒ
</span><span class="n">openai_embeddings</span> <span class="o">=</span> <span class="nc">OpenAIEmbeddings</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="sh">"</span><span class="s">text-embedding-3-small</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Sentence Transformers - ë¬´ë£Œ, í•œêµ­ì–´ ì§€ì› ì¢‹ìŒ
</span><span class="kn">from</span> <span class="n">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">HuggingFaceEmbeddings</span>
<span class="n">huggingface_embeddings</span> <span class="o">=</span> <span class="nc">HuggingFaceEmbeddings</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="sh">"</span><span class="s">jhgan/ko-sroberta-multitask</span><span class="sh">"</span>
<span class="p">)</span>

<span class="c1"># ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ í•„ìš”
</span><span class="k">def</span> <span class="nf">compare_embeddings</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">embedding_models</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">embedding_models</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">embed_query</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: ë²¡í„° ì°¨ì› </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ê²€ìƒ‰-í’ˆì§ˆ-í–¥ìƒ-ê¸°ë²•">3. ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ ê¸°ë²•</h3>

<p><strong>ì»¨í…ìŠ¤íŠ¸ ì••ì¶•:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain.retrievers</span> <span class="kn">import</span> <span class="n">ContextualCompressionRetriever</span>
<span class="kn">from</span> <span class="n">langchain.retrievers.document_compressors</span> <span class="kn">import</span> <span class="n">LLMChainExtractor</span>

<span class="c1"># ê´€ë ¨ì—†ëŠ” ë‚´ìš© ì œê±°
</span><span class="n">compressor</span> <span class="o">=</span> <span class="n">LLMChainExtractor</span><span class="p">.</span><span class="nf">from_llm</span><span class="p">(</span><span class="n">llm</span><span class="p">)</span>
<span class="n">compression_retriever</span> <span class="o">=</span> <span class="nc">ContextualCompressionRetriever</span><span class="p">(</span>
    <span class="n">base_compressor</span><span class="o">=</span><span class="n">compressor</span><span class="p">,</span>
    <span class="n">base_retriever</span><span class="o">=</span><span class="n">retriever</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Self-Query ê²€ìƒ‰:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">langchain.retrievers.self_query.base</span> <span class="kn">import</span> <span class="n">SelfQueryRetriever</span>

<span class="c1"># ìì—°ì–´ ì§ˆë¬¸ì„ ë©”íƒ€ë°ì´í„° í•„í„°ë¡œ ë³€í™˜
</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">SelfQueryRetriever</span><span class="p">.</span><span class="nf">from_llm</span><span class="p">(</span>
    <span class="n">llm</span><span class="p">,</span>
    <span class="n">vectorstore</span><span class="p">,</span>
    <span class="n">document_content_description</span><span class="o">=</span><span class="sh">"</span><span class="s">ê¸°ìˆ  ë¬¸ì„œ</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">metadata_field_info</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">source</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ë¬¸ì„œ ì¶œì²˜</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">},</span>
        <span class="p">{</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì‘ì„± ë‚ ì§œ</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="4-rag-íŒŒì´í”„ë¼ì¸-í‰ê°€-ë°-ë””ë²„ê¹…">4. RAG íŒŒì´í”„ë¼ì¸ í‰ê°€ ë° ë””ë²„ê¹…</h3>

<p><strong>ê²€ìƒ‰ ê²°ê³¼ í‰ê°€:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">debug_retrieval</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">retriever</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">.</span><span class="nf">get_relevant_documents</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì§ˆë¬¸: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê²€ìƒ‰ëœ ë¬¸ì„œ ìˆ˜: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">[:</span><span class="n">k</span><span class="p">]):</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">ë¬¸ì„œ </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë‚´ìš©: </span><span class="si">{</span><span class="n">doc</span><span class="p">.</span><span class="n">page_content</span><span class="p">[</span><span class="si">:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë©”íƒ€ë°ì´í„°: </span><span class="si">{</span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ë‹µë³€ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">evaluate_rag_response</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">context_docs</span><span class="p">,</span> <span class="n">answer</span><span class="p">):</span>
    <span class="c1"># ì»¨í…ìŠ¤íŠ¸ ê´€ë ¨ì„± ì²´í¬
</span>    <span class="n">context_text</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="n">doc</span><span class="p">.</span><span class="n">page_content</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">context_docs</span><span class="p">])</span>

    <span class="n">relevance_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
    ì§ˆë¬¸: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s">
    ì»¨í…ìŠ¤íŠ¸: </span><span class="si">{</span><span class="n">context_text</span><span class="si">}</span><span class="s">
    ë‹µë³€: </span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="s">

    ë‹µë³€ì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ê³  ìˆëŠ”ì§€ 1-10ì ìœ¼ë¡œ í‰ê°€í•˜ì„¸ìš”.
    </span><span class="sh">"""</span>

    <span class="c1"># LLMìœ¼ë¡œ ë‹µë³€ í’ˆì§ˆ í‰ê°€
</span>    <span class="n">score</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">relevance_prompt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>
</code></pre></div></div>

<h3 id="5-í”„ë¡œë•ì…˜-í™˜ê²½ì—ì„œì˜-ê³ ë ¤ì‚¬í•­">5. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œì˜ ê³ ë ¤ì‚¬í•­</h3>

<p><strong>ë²¡í„°DB ì„ íƒ ê¸°ì¤€:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì†Œê·œëª¨ í”„ë¡œí† íƒ€ì… - Chroma
</span><span class="n">chroma_db</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># ì¤‘ê·œëª¨ ì„œë¹„ìŠ¤ - Pinecone
</span><span class="kn">from</span> <span class="n">langchain_pinecone</span> <span class="kn">import</span> <span class="n">Pinecone</span>
<span class="n">pinecone_db</span> <span class="o">=</span> <span class="n">Pinecone</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="sh">"</span><span class="s">my-index</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ëŒ€ê·œëª¨ ì—”í„°í”„ë¼ì´ì¦ˆ - Weaviate
</span><span class="kn">from</span> <span class="n">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Weaviate</span>
<span class="n">weaviate_db</span> <span class="o">=</span> <span class="n">Weaviate</span><span class="p">.</span><span class="nf">from_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ìºì‹± ì „ëµ:</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cached_retrieval</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">retriever</span><span class="p">.</span><span class="nf">get_relevant_documents</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>

<span class="c1"># Redis ìºì‹±
</span><span class="kn">import</span> <span class="n">redis</span>
<span class="kn">import</span> <span class="n">pickle</span>

<span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="nc">Redis</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">redis_cached_retrieval</span><span class="p">(</span><span class="n">question</span><span class="p">):</span>
    <span class="n">cached</span> <span class="o">=</span> <span class="n">redis_client</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">rag:</span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">.</span><span class="nf">get_relevant_documents</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
    <span class="n">redis_client</span><span class="p">.</span><span class="nf">setex</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">rag:</span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<p><strong>ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­:</strong></p>

<ul>
  <li>ê²€ìƒ‰ ì§€ì—°ì‹œê°„</li>
  <li>ë‹µë³€ ìƒì„± ì‹œê°„</li>
  <li>í† í° ì‚¬ìš©ëŸ‰</li>
  <li>ê²€ìƒ‰ ì •í™•ë„ (ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜)</li>
  <li>ì»¨í…ìŠ¤íŠ¸ í™œìš©ë¥ </li>
</ul>

    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
            <a class="prev-post" href="/ml-ai/LCEL3/">
                <span class="nav-label">ì´ì „ ê¸€</span>
                <span class="nav-title">LCEL (LangChain Expression ...</span>
            </a>
            
            
            
            <a class="next-post" href="/ml-ai/evaluation/">
                <span class="nav-label">ë‹¤ìŒ ê¸€</span>
                <span class="nav-title">RAG ì‹œìŠ¤í…œ í‰ê°€í•˜ê¸°</span>
            </a>
            
        </div>
        
        <div class="back-to-home">
            <a href="/">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </footer>
</article>
            </div>
        </main>
    </div>
</body>
</html>